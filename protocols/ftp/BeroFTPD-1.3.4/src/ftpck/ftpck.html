<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>ftpck: WU-FTPD configuration checker</TITLE>
<LINK REV="made" HREF="mailto:archive@landfield.com">
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<H1 ALIGN=CENTER>ftpck:<BR>WU-FTPD configuration checker</H1>
<P ALIGN=CENTER><STRONG><EM>Last updated: June 23, 1997</EM></STRONG></P>
<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>
<H2>Table of Contents</H2>
<UL>
<LI><A HREF="#what">What is ftpck ?</A>
<LI><A HREF="#status">Current development status</A>
<LI><A HREF="#tests">What does it test ?</A>
<SMALL>
<UL>
<LI><A HREF="#ftpaccess">ftpaccess</A>
<LI><A HREF="#ftpconversions">ftpconversions</A>
<LI><A HREF="#ftphosts">ftphosts</A>
<LI><A HREF="#ftppidnames">ftppidnames</A>
<LI><A HREF="#ftpgroups">ftpgroups</A>
<LI><A HREF="#ftpservers">ftpservers</A>
<LI><A HREF="#ftpusers">ftpusers</A>
<LI><A HREF="#xferlogs">xferlogs</A>
<LI><A HREF="#path-exec">_PATH_EXECPATH</A>
<LI><A HREF="#inetd_conf">inetd.conf</A>
</UL>
</SMALL>
<LI><A HREF="#software">Getting ftpck</A>
<LI><A HREF="#install">Installing ftpck</A>
<LI><A HREF="#run">Running ftpck</A>
<LI><A HREF="http://www.landfield.com/HyperNews/get/wu-ftpd/ftpck.html">Development Comments</A>
</UL>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="what" HREF="#">What is ftpck</A></H2>
<BLOCKQUOTE>

<STRONG>ftpck</STRONG> is utility to verify the various files required to
run wu-ftpd. 
<P>
Since the beginning, the only wu-ftpd configuration checker was "ckconfig". 
All it did was simply check to see if the needed files were where they had 
been specified in pathnames.h.  Other than that, you had to look at the man 
pages, examples and the source code to try and figure out what was the proper 
syntax.  In some cases, ftpaccess file directives were added but not listed 
in the man pages or READMEs.  
<P>
ftpck is intended to check all files and fields in all the files to assure 
proper syntax.  It checks to assure that all files referenced in the various
wu-ftpd system files exist.  It checks modes on files as well as modes on ftp 
directories specified.  
<P>
This is a third developmental version and is finally nearing public release.
<P>
Please help me complete this.  It has already pointed out errors in my 
configuration here and I'm sure it will help you as well.  I need suggestions
about what checks make sense and should be added. Also I need help deciding
what should be listed as an ERROR: and what should be listed as a WARNING:.
Please help me create a useful and complete wu-ftpd configuration checker for 
all to use.
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="status" HREF="#">Current development status</A></H2>
<BLOCKQUOTE>
<STRONG>June 3, 1997:</STRONG>
This has been cleaned up greatly with all ftpaccess records now being 
checked.  There a only a couple checks still needed and we are entering
the cleanup phase in preparation for release. It has not been converted 
to ANSI C yet. That is coming.
<P>
This was developed on Solaris 2.5 and there may be portability concerns.  I
hope not but if so, please send me any required patches and I'll add them.
<P>
I could use some help.  <STRONG>Portability testing</STRONG> is what I need 
most.
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="tests" HREF="#">What does it test ?</A></H2>
<BLOCKQUOTE>
This list nearly complete. At present the following things are checked.
<P>
The following WU-FTPD configuration files being tested.
<BLOCKQUOTE>
<A HREF="#ftpaccess">ftpaccess</A>,
<A HREF="#ftpconversions">ftpconversions</A>,
<A HREF="#ftphosts">ftphosts</A>,
<A HREF="#ftppidnames">ftppidnames</A>,
<BR>
<A HREF="#ftpgroups">ftpgroups</A>,
<A HREF="#ftpservers">ftpservers</A>,
<A HREF="#ftpusers">ftpusers</A>,
<A HREF="#xferlogs">xferlogs</A>
</BLOCKQUOTE>
Additionally, 
<A HREF="#path-exec">the _PATH_EXECPATH define</A>, is checked as is the
<A HREF="#inetd-conf">inetd.conf</A> file.
<P>
The plan is to:
<UL>
<LI>assure complete ftpaccess file checking is done,
<LI>final cleanup with manual page,
<LI>write a separate utility which checks permissions, modes, ownership,
    number of links, etc. of the individual ftp data directories.  This
    utility is tenatively named <STRONG>auditftp</STRONG>.
</UL>
Please send suggestions to 
<A HREF="mailto:kent@landfield.com">kent@landfield.com</A> concerning tests 
you would like to see done.  
<P>
<H3><A NAME="ftpaccess" HREF="#">ftpaccess</A></H3>
<BLOCKQUOTE>
<OL>
<LI>The existence of the specified ftpaccess file is verified.
<LI>Modes on each of the specified ftpaccess files are checked to assure 
    they are 0600.
</OL>
In addition, each record in the file is verified. 
<OL>
<LI><STRONG>alias</STRONG> directive
    <UL>
    <LI>Improper number of fields
    </UL>
     The Following checks can be compiled in or requested at runtime.
    <UL>
    <LI>Checks if directory aliased exists for real users
    <LI>Checks if directory aliased exists for anonymous users
    </UL>
<LI><STRONG>autogroup</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Groupname specified is a valid system group
    <LI>Checks each "class" specified to assure it is a valid "class"
    </UL>
<LI><STRONG>banner</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Checks if banner message file exists 
    </UL>
<LI><STRONG>cdpath</STRONG> directive
    <UL>
    <LI>Improper number of fields
    </UL>
     The Following checks can be compiled in or requested at runtime.
    <UL>
    <LI>Checks if directory aliased exists for real users
    <LI>Checks if directory aliased exists for anonymous users
    </UL>
<LI><STRONG>class</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Verify there is a valid typelist specified
    <LI>Verify the Domain and/or IP address globbing passed in
    </UL>
<LI><STRONG>compress and tar</STRONG> directives
    <UL>
    <LI>Improper number of fields
    <LI>Invalid "yes/no" specified
    <LI>Checks each "class" specified to assure it is a valid "class"
    </UL>
<LI><STRONG>chmod, delete, overwrite, rename and umask</STRONG> directives
    <UL>
    <LI>Improper number of fields
    <LI>Invalid "yes/no" specified
    <LI>Assures &lt;typelist&gt; is a comma-separated list of any of the 
        keywords "anonymous", "guest" and "real".
    </UL>
<LI><STRONG>deny</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Checks for valid Address, domain or !nameserved 
    <LI>Checks to assure the message file exists 
    </UL>
<LI><STRONG>email</STRONG> directive
    <UL>
    <LI>Improper number of fields
    </UL>
<LI><STRONG>guestgroup</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Groupnames specified are valid system groups
    </UL>
<LI><STRONG>guestserver</STRONG> directive
    <UL>
    <LI>Improper number of fields
    </UL>
<LI><STRONG>limit</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check if valid class specified
    <LI>Check &lt;n&gt; is a number
    <LI>Valid &lt;time&gt; specified (valid_time TBD)
    <LI>Message file exists in guest and real ftp directories
    </UL>
<LI><STRONG>log</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Checks both the `log transfers' and `log commands' entries.
    <LI>Assures &lt;typelist&gt; is a comma-separated list of any of the 
    <LI>Checks directions
    </UL>
<LI><STRONG>logfile</STRONG> directive (new virtual support directive)
    <UL>
    <LI>Improper number of fields
    <LI>Assure logfile exists at specified path
    </UL>
<LI><STRONG>loginfails</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>content is a number
    </UL>
<LI><STRONG>lslong and lsshort</STRONG> directives
    <UL>
    <LI>Verify the specified executable exists
    </UL>
<LI><STRONG>message</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check the &lt;when&gt; specified is valid
    <LI>Verify any classes listed are valid system classes
    </UL>
<LI><STRONG>noretrieve</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check the to assure the &lt;filename&gt; file is available
    </UL>
<LI><STRONG>passwd-check</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check for &lt;none|trivial|rfc822&gt; validity
    <LI>Check for &lt;enforce|warn&gt; validity
    </UL>
<LI><STRONG>path-filter</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check typelist specified is valid
    <LI>Verify message file path exists
    </UL>
<LI><STRONG>private</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Invalid "yes/no" specified
    <LI>If "private  yes" check to see if _PATH_PRIVATE exists
    </UL>
<LI><STRONG>readme</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check the &lt;when&gt; is valid
    <LI>Verify any classes listed are valid system classes
    </UL>
<LI><STRONG>root</STRONG> directive (new virtual support directive)
    <UL>
    <LI>Improper number of fields
    <LI>Verify specified ftpd root data directory exists
    <LI>Check to assure path is a directory.
    </UL>
<LI><STRONG>shutdown</STRONG> directive
    <UL>
    <LI>Improper number of fields
    </UL>
<LI><STRONG>upload</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Check to assure maximum of 7 arguments
    <LI>Make sure &lt;root-dir&gt; matches the ftp user passwd file homedir
    <LI>Check if ARG2 is yes/no
    <LI>Validate dirs/nodirs
    <LI>Assure the mode specified is sane
    <LI>Assure any specified user has a passwd file entry
    <LI>Assure any specified group has a group file entry
    </UL>
<LI><STRONG>virtual</STRONG> directive
    <UL>
    <LI>Improper number of fields
    <LI>Make sure &lt;addr&gt; seems sane
    <LI>Check if ARG1 is root/banner/logfile
    <LI>Assure path exists (only from machine root)
    <LI>Assure root path is a directory
    <LI>Assure banner and logfiles are regular files
    </UL>
</OL>
Also checks for invalid directives used in the ftpaccess files.
</BLOCKQUOTE>

<P>
<H3><A NAME="ftpconversions" HREF="#">ftpconversions</A></H3>
<OL>
<LI>The existence of the ftpconversions file is verified.
<LI>Modes on the ftpconversions file are checked to assure they are 0600.
<LI>Verify syntax of the ftpconversions file.
<LI>Verify specified external commands exist in the root.
<LI>Verify specified external commands exist in the anonymous area.
<LI>Verify 'types' specified are valid.
<LI>Verify 'options' specified are valid.
</OL>
<P>
<H3><A NAME="ftphosts" HREF="#">ftphosts</A></H3>
<OL>
<LI>The existence of the ftphosts file is verified.
<LI>Modes on the ftphosts file are checked to assure they are 0600.
<LI>Verify syntax of the ftpgroups file.
<LI>Verify allow/deny keyword usage.
<LI>Verify valid domain and IP globbing specified.
</OL>
<P>
<H3><A NAME="ftppidnames" HREF="#">ftppidnames</A></H3>
<OL>
<LI>Checks the existence of the runtime pid file directory.
</OL>
<P>
<H3><A NAME="ftpgroups" HREF="#">ftpgroups</A></H3>
<OL>
<LI>The existence of the ftpgroups file is verified.
<LI>Modes on the ftpgroups file are checked to assure they are 0600.
<LI>Verify syntax of the ftpgroups file.
<LI>Make sure the groups specified are valid system groups.
</OL>
<P>
<H3><A NAME="ftpservers" HREF="#">ftpservers</A></H3>
<OL>
<LI>The existence of the ftpservers file is verified if VIRTUAL_SERVER support 
    compiled in.
<LI>Modes on the ftpservers file are checked to assure they are 0600.
<LI>Checks to assure all ftpaccess files specified in the ftpservers file exist.
<LI>All specified ftpaccess files are then themselves checked via the ftpaccess
    tests listed above.
</OL>
<P>
<H3><A NAME="ftpusers" HREF="#">ftpusers</A></H3>
<OL>
<LI>The existence of the ftpusers file is verified.
<LI>Modes on the ftpusers file are checked to assure they are 0600.
<LI>Account names not longer than 8 characters.
<LI>Assure only one item per line.
<LI>Records are newline terminated.
<LI>Check root and all system accounts are in ftpusers file.
</OL>
<P>
<H3><A NAME="xferlogs" HREF="#">xferlogs</A></H3>
<OL>
<LI>The existence of the xferlog files are verified.  All xferlogs are 
    checked if the site has indicated the use of virtual server support. 
<LI>Modes on the xferlog file are checked to assure they are 0660.
</OL>
<P>
<H3><A NAME="path-exec" HREF="#">_PATH_EXECPATH</A></H3>
<OL>
<LI>Checks to assure you have not compiled WU-FTPD with _PATH_EXECPATH set
    to /bin, /usr/bin, /etc or /sbin. Doing so would open potential or real
    security holes onto your system.
</OL>
<P>
<H3><A NAME="inetd_conf" HREF="#">inetd.conf</A></H3>
<OL>
<LI>Check to assure the "-a" option is specified on the 'ftp' entry. Without it
    all ftpaccess functionality is disabled.
</OL>
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="software" HREF="#">Getting ftpck</A></H2>
<BLOCKQUOTE>
You can get the current snapshot of ftpck from 
<A HREF="ftp://ftp.landfield.com/wu-ftpd/ftpck/">ftp://ftp.landfield.com/wu-ftpd/ftpck/</A>
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="install" HREF="#">Installing ftpck</A></H2>
<BLOCKQUOTE>
As the distribution is configured, it needs to be unpacked under the wu-ftpd 
src/ directory.  The tar/shar files will create a subdirectory ftpck.X.x.  
You will need to edit the Makefile in the ftpck directory and make sure 
things are right for your installation.  It is setup to use your existing 
pathnames.h and config.h files. 
<P>
You will want to check ftpck.h to assure the defines are appropriate for 
your local installation's policy.
<P>
Type make and build it.  Test it from that directory.  When you are 
satisfied it does the right things, type make install and then go verify 
your config.
<P>
Note: rdservers.c is not used unless you have compiled in Virtual 
Hosting support. If so, make sure you put -DVIRTUAL in the CFLAGS. 
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<H2><A NAME="run" HREF="#">Running ftpck</A></H2>
<BLOCKQUOTE>
<SMALL>
<PRE>
usage: ftpck [ -ceFghprstuvx ] [-f accessfile]

With no options, all WU-FTPD configuration files are checked.
More than one set of checks can be specified at a time.

Options for checking default config files
  -c:             Check ftpconversions file at /etc/ftpd/ftpconversions
  -f:             Check ftpaccess file at /etc/ftpd/ftpaccess
  -g:             Check ftpgroups file at /etc/ftpd/ftpgroups
  -h:             Check ftphosts file at /etc/ftpd/ftphosts
  -p:             Check pid directory at /etc/ftpd/ftp.pids-%s
  -s:             Check ftpservers file at /etc/ftpd/ftpservers
  -u:             Check ftpusers file at /etc/ftpd/ftpusers
  -x:             Check xferlog file at /etc/ftpd/xferlog

Check named file options
  -C conversions: Check the specified ftpconversions file
  -F ftpaccess:   Check the specified ftpaccess file
  -G ftpgroups:   Check the specified ftpgroups file
  -H ftphosts:    Check the specified ftphosts file
  -S ftpservers:  Check the specified ftpservers file
  -U ftpusers:    Check the specified ftpusers file

Other options
  -a:             Verify aliases and cdpaths usable for
                  anonymous/virtual ftp users
  -d:             Turn on describe mode. (Very verbose) A
                  second -d enables accessfile line display
  -e:             Check _PATH_EXECPATH not == /bin
  -i:             Check inetd.conf file at /etc/inetd.conf
  -I inetd.conf:  Check the specified inetd.conf file
  -r:             Verify aliases and cdpaths usable for real systm users
  -v:             Produce verbose output
</PRE>
</SMALL>
<STRONG>Please Note:</STRONG> The files specified in the above usage example
represent the test location of the various WU-FTPD config files on my system. 
These paths are dependent on the specifications in the pathnames.h you use.
</BLOCKQUOTE>

<P ALIGN=CENTER><IMG SRC="http://www.landfield.com/images/clrbar.gif" WIDTH=400 HEIGHT=2 ALT="----"></P>

<ADDRESS>
<P ALIGN=CENTER>
<SMALL>
<STRONG>
<A HREF="mailto:archive@landfield.com">archive@landfield.com</A>
</STRONG>
</SMALL>
</P>
</ADDRESS>
</BODY>
</HTML>
