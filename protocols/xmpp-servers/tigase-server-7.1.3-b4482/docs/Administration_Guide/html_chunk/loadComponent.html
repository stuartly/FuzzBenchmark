<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="oldVerSchemas.html" title="Schema Updates"><link rel="next" href="_tigase_http_api.html" title="Tigase HTTP API"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="oldVerSchemas.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_tigase_http_api.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="loadComponent"></a>Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="loadComponent.html#stanzaSender">StanzaSender</a></span></dt><dd><dl><dt><span class="section"><a href="loadComponent.html#_how_it_works">How it Works</a></span></dt><dt><span class="section"><a href="loadComponent.html#_configuration_3">Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="_tigase_http_api.html">Tigase HTTP API</a></span></dt><dd><dl><dt><span class="section"><a href="_tigase_http_api.html#_requirements">Requirements</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#_setup_configuration">Setup &amp; Configuration</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#_use_of_the_http_api">Use of the HTTP API</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#_browser_interface_walk_through">Browser interface walk-through</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#_http_api_scripting">HTTP API Scripting</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#restAPI">REST API &amp; HTTP Guide</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#adminUI">Admin UI Guide</a></span></dt><dt><span class="section"><a href="_tigase_http_api.html#webClient">Tigase Web Client</a></span></dt></dl></dd><dt><span class="section"><a href="messageArchiving.html">Message Archiving Component</a></span></dt><dd><dl><dt><span class="section"><a href="messageArchiving.html#_installation_2">Installation</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_configuration_7">Configuration</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_usage_3">Usage</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_manual_activation">Manual Activation</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_automatic_activation_of_muc_messages">Automatic Activation of MUC messages</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_searching_for_messages">Searching for Messages</a></span></dt><dt><span class="section"><a href="messageArchiving.html#_message_tagging_support">Message Tagging Support</a></span></dt><dt><span class="section"><a href="messageArchiving.html#maPurging">Purging Information from Message Archive</a></span></dt></dl></dd><dt><span class="section"><a href="amp0079.html">Advanced Message Processing - AMP XEP-0079</a></span></dt><dd><dl><dt><span class="section"><a href="amp0079.html#_first_of_all_plugins">First of all: plugins:</a></span></dt><dt><span class="section"><a href="amp0079.html#_secondly_component">Secondly: component:</a></span></dt><dt><span class="section"><a href="amp0079.html#_optional_parameters">Optional parameters:</a></span></dt></dl></dd><dt><span class="section"><a href="PubSubComp.html">PubSub Component</a></span></dt><dd><dl><dt><span class="section"><a href="PubSubComp.html#_configuration_9">Configuration</a></span></dt><dt><span class="section"><a href="PubSubComp.html#_pubsub_naming">Pubsub naming</a></span></dt><dt><span class="section"><a href="PubSubComp.html#rosterLimit">Configure Roster Maxmimum size</a></span></dt><dt><span class="section"><a href="PubSubComp.html#_adhoc_commands">AdHoc Commands</a></span></dt><dt><span class="section"><a href="PubSubComp.html#_pubsub_node_presence_protocol">PubSub Node Presence Protocol</a></span></dt><dt><span class="section"><a href="PubSubComp.html#storeFullXMLLastPresence">Store Full XML of Last Presence</a></span></dt><dt><span class="section"><a href="PubSubComp.html#offlineMessageSink">Offline Message Sink</a></span></dt><dt><span class="section"><a href="PubSubComp.html#PubsubSchemaChanges">PubSub Schema Changes</a></span></dt></dl></dd><dt><span class="section"><a href="serverMonitoring.html">Server Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="serverMonitoring.html#setUpRemoteMonitoring">Setting Up Remote Monitoring in the Server</a></span></dt><dt><span class="section"><a href="serverMonitoring.html#retrievingStatisticsFromTheServer">Retrieving statistics from the server</a></span></dt><dt><span class="section"><a href="serverMonitoring.html#statsticsDescription">Statistics description</a></span></dt></dl></dd><dt><span class="section"><a href="eventBus.html">Eventbus</a></span></dt><dd><dl><dt><span class="section"><a href="eventBus.html#_setup">Setup</a></span></dt><dt><span class="section"><a href="eventBus.html#_how_it_works_2">How it Works</a></span></dt><dt><span class="section"><a href="eventBus.html#availableTasks">Available Tasks</a></span></dt><dt><span class="section"><a href="eventBus.html#_configuration_11">Configuration</a></span></dt><dt><span class="section"><a href="eventBus.html#_getting_the_message">Getting the Message</a></span></dt><dt><span class="section"><a href="eventBus.html#monitorMailer">Mailer Extension</a></span></dt></dl></dd><dt><span class="section"><a href="v5xs2sps.html">Server to Server Protocol Settings</a></span></dt><dd><dl><dt><span class="section"><a href="v5xs2sps.html#_number_of_concurrent_connections">Number of Concurrent Connections</a></span></dt><dt><span class="section"><a href="v5xs2sps.html#_connection_throughput">Connection Throughput</a></span></dt><dt><span class="section"><a href="v5xs2sps.html#_maximum_packet_waiting_time_and_connection_inactivity_time">Maximum Packet Waiting Time and Connection Inactivity Time</a></span></dt><dt><span class="section"><a href="v5xs2sps.html#_custom_plugin_selecting_s2s_connection">Custom Plugin: Selecting s2s Connection</a></span></dt></dl></dd><dt><span class="section"><a href="tigaseMUC.html">Tigase MUC Component</a></span></dt><dd><dl><dt><span class="section"><a href="tigaseMUC.html#_configuration_options">Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="loadBalancing.html">Tigase Load Balancing</a></span></dt><dd><dl><dt><span class="section"><a href="loadBalancing.html#_available_implementations">Available Implementations</a></span></dt><dt><span class="section"><a href="loadBalancing.html#_configuration_options_2">Configuration Options</a></span></dt><dt><span class="section"><a href="loadBalancing.html#_auxiliary_setup_options">Auxiliary setup options</a></span></dt></dl></dd><dt><span class="section"><a href="externalComponentConfiguration.html">External Component Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="externalComponentConfiguration.html#tigase4xbasicConfiguration">Basic Configuration Options (External Component)</a></span></dt><dt><span class="section"><a href="externalComponentConfiguration.html#tigase4xexternalComponent">Tigase as an External Component</a></span></dt><dt><span class="section"><a href="externalComponentConfiguration.html#loadBalancingExternalComponent">Load Balancing External Components in Cluster Mode</a></span></dt></dl></dd><dt><span class="section"><a href="c2scomponent.html">Client to Server Communication</a></span></dt><dt><span class="section"><a href="_configuration_12.html">Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="_configuration_12.html#_resumption_timeout">Resumption timeout</a></span></dt><dt><span class="section"><a href="_configuration_12.html#packetRedelivery">Packet Redelivery</a></span></dt></dl></dd><dt><span class="section"><a href="socks5.html">Socks 5 Component</a></span></dt><dd><dl><dt><span class="section"><a href="socks5.html#_installation_3">Installation</a></span></dt><dt><span class="section"><a href="socks5.html#_database_preparation">Database Preparation</a></span></dt><dt><span class="section"><a href="socks5.html#_configuration_13">Configuration</a></span></dt><dt><span class="section"><a href="socks5.html#_database_usage_for_specific_settings">Database usage for specific settings</a></span></dt><dt><span class="section"><a href="socks5.html#_example_init_properties_block">Example init.properties block</a></span></dt></dl></dd><dt><span class="section"><a href="tigase41virtualHosts.html">Virtual Hosts in Tigase Server</a></span></dt><dd><dl><dt><span class="section"><a href="tigase41virtualHosts.html#ad-hocCommands">Specification for ad-hoc Commands Used to Manage Virtual Domains</a></span></dt><dt><span class="section"><a href="tigase41virtualHosts.html#virtualComponents">Virtual Components for the Cluster Mode</a></span></dt></dl></dd></dl></div><p>A detailed description of all the configuration options is in the init.properties guide where you can also find information described below and much more. The purpose of this document is to give you a brief introduction on how to load a component into Tigase server without the need to dig through all the details.</p><p>I will show how to load 2 components into Tigase server using a configuration in the init.properties file: <a class="link" href="https://projects.tigase.org/projects/tigase-muc" target="_top">MUC</a> and <a class="link" href="https://projects.tigase.org/projects/tigase-pubsub" target="_top">PubSub</a>.</p><p>The only step is to tell the server what components to load, how to name them and optionally give some extra parameters. To do so open the init.properties file you use in your installation.</p><p>Let&#8217;s say you want to just add PubSub for now. All you need to do is add 2 lines to the properties file:</p><pre class="programlisting">--comp-name-1=pubsub
--comp-class-1=tigase.pubsub.PubSubComponent</pre><p>The first line contains the component name 'pubsub' and the main class for this component is: 'tigase.pubsub.PubSubClusterComponent'. It doesn&#8217;t really matter what the component name is, the only requirement is that it must be unique among other components names. Because you can load many components, it helps to provide descriptive names thus 'pubsub' is a good name for a 'PubSub' component.</p><p>You can of course add more components, even PubSub components to the same server. Just remember that each of them would need to have a different name then. For example:</p><pre class="programlisting">--comp-name-2=pubsub-priv
--comp-class-2=tigase.pubsub.PubSubComponent</pre><p>Although this may be rare, it allows for wide compatibility and platform stability.</p><p>Normally, however we want to load few different components like PubSub, MUC, MSN Transport and so on&#8230;&#8203;. Therefore instead of the above second PubSub we can load the MUC component:</p><pre class="programlisting">--comp-name-2=muc
--comp-class-2=tigase.muc.MUCComponent</pre><p>Changes to the init.properties file will take effect upon server restart.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="stanzaSender"></a>StanzaSender</h2></div></div></div><p>StanzaSender is a component which makes it easier to integrate XMPP server with other third-party tools.</p><p>It simply allows you to send stanzas from your application without implementing any XMPP specific code. The component regularly reads specified data source for XMPP packets to send. The data source can be a SQL database, directory on your filesystem, or anything you might want.</p><p>If you have a Web application for example for which you want to send notifications of an event to selected users you can install <a class="link" href="https://projects.tigase.org/projects/tigase-server/repository/revisions/master/show/src/main/java/tigase/server/ssender" target="_top">StanzaSender</a> component on your Tigase server. It will help you to easily distribute your messages to end-users.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_how_it_works"></a>How it Works</h3></div></div></div><p>The module itself doesn&#8217;t do anything, it just schedules tasks and sends stanzas which come from anywhere. To do the actual work of retrieving stanzas from data source the component uses <span class="strong"><strong>tasks</strong></span>.</p><p>In theory the task can retrieve XMPP packets for sending from any location or may just generate stanzas on its own.</p><p>In practice there are 2 <span class="strong"><strong>tasks</strong></span> already implemented and ready to use. You can treat them as a sample code for implementation of your own tasks customised for your specific needs or you can just use these tasks as they are.</p><p>The tasks which are available are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">FileTask retrieving stanzas from directory in file system.</li><li class="listitem">JDBCTask retrieving stanzas from SQL database.</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_filetask"></a>FileTask</h4></div></div></div><p>FileTask implements tasks for cyclic retrieving stanzas from a directory and sending them to the StanzaHandler object.</p><p>It looks for any new stanza to send. Any single file can contain only a single stanza to send and any entry in database table can also contain only a single stanza to send. Files on hard disk and records in databases are deleted after it is read.</p><p>Any file in a given directory is treated the same way - Tigase assumes it contains valid XML data with XMPP stanza to send. You can however set in configuration, using wildchars which files contain stanzas. All stanzas must contain complete data including correct "<span class="emphasis"><em>from</em></span>" and "<span class="emphasis"><em>to</em></span>" attributes.</p><p>By default it is looking for *.stanza files in /var/spool/jabber/ folder but you can specify different directory names in the initialization string. Here is a sample initialization strings:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">/var/spool/jabber/*.stanza</li><li class="listitem">/var/spool/jabber/*</li></ul></div><p>The last is equal to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">/var/spool/jabber/</li></ul></div><p>Note the last forward slash '/' is required in such case if the last element of the path is a directory.</p><p><span class="strong"><strong>Please note! Tigase must have writing permissions for this directory, otherwise it may not function properly.</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_jdbctask"></a>JDBCTask</h4></div></div></div><p>JDBCTask implements tasks for cyclic retrieving stanzas from database and sending them to the StanzaHandler object.</p><p>Database table format:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>id</strong></span> - numerical unique record identifier.</li><li class="listitem"><span class="strong"><strong>stanza</strong></span> - text field containing valid XML data with XMPP stanza to send.</li></ul></div><p>Any record in this table is treated the same way - Tigase assumes it contains valid XML data with XMPP stanza to send. No other data are allowed in this table. All stanzas must be complete including correct "<span class="emphasis"><em>from</em></span>" and "<span class="emphasis"><em>to</em></span>" attributes.</p><p>By default it is looking for stanzas in xmpp_stanza table, but you can specify a different table name in the connection string. For example:</p><p>jdbc:mysql://localhost/tigasedb?user=tigase&amp;password=pass&amp;table=xmpp_stanza</p><p>Please note the last parameter which is specific to JDBCTask. You can specify the table name which stores stanzas for sending, if omitted default value is: xmpp_stanza.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuration_3"></a>Configuration</h3></div></div></div><p>StanzaSender is a Tigase component so the configuration is similar to that of all other components. The simplest way to get the settings for <span class="strong"><strong>StanzaSender</strong></span> is by generating a configuration with all possible components. To do this you have to run Tigase server with --gen-config-all parameter set.</p><p>By default this component name is <span class="strong"><strong>ssend</strong></span> and here is a content of the configuration file for <span class="strong"><strong>StanzaSender</strong></span>:</p><p>It is one of msg-receivers:</p><pre class="programlisting">&lt;entry type="String[]" key="id-names"&gt;
  ...
  &lt;item value="ssend"/&gt;
&lt;/entry&gt;</pre><p>To activate the component and a specify class name for it following entries has been added:</p><pre class="programlisting">&lt;entry value="true" type="Boolean" key="ssend.active"/&gt;
&lt;entry value="tigase.server.ssender.StanzaSender" type="String" key="ssend.class"/&gt;</pre><p>And the main settings section for the component:</p><pre class="programlisting">&lt;component name="ssend"&gt;
  &lt;map&gt;
   &lt;entry value="10" type="Long" key="default-interval"/&gt;
   &lt;entry value="1000" type="Integer" key="max-queue-size"/&gt;
   &lt;entry type="String[]" key="stanza-listeners"&gt;
    &lt;item value="jdbc"/&gt;
    &lt;item value="file"/&gt;
   &lt;/entry&gt;
  &lt;/map&gt;
  &lt;node name="file"&gt;
   &lt;map&gt;
    &lt;entry value="true" type="Boolean" key="active"/&gt;
    &lt;entry value="tigase.server.ssender.FileTask" type="String" key="class-name"/&gt;
    &lt;entry value="/var/spool/jabber/*.stanza" type="String" key="init-string"/&gt;
    &lt;entry value="10" type="Long" key="interval"/&gt;
   &lt;/map&gt;
  &lt;/node&gt;
  &lt;node name="jdbc"&gt;
   &lt;map&gt;
    &lt;entry value="true" type="Boolean" key="active"/&gt;
    &lt;entry value="tigase.server.ssender.JDBCTask" type="String" key="class-name"/&gt;
    &lt;entry value="jdbc:mysql://localhost/tigase?user=tigase&amp;
        password=mypass&amp;table=xmpp_stanza"
      type="String" key="init-string"/&gt;
    &lt;entry value="10" type="Long" key="interval"/&gt;
   &lt;/map&gt;
  &lt;/node&gt;
 &lt;/component&gt;</pre><p>Most parameters should be pretty clear but some may need a little explanation.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_general_stanzasender_parameters"></a>General StanzaSender parameters:</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>default-interval</strong></span> number which specifies in seconds how often should the task look in data source for new packets to send.</li><li class="listitem"><span class="strong"><strong>max-queue-size</strong></span> is a number which specifies internal packets queue size. This is used to prevent the component from consuming all the memory for data in case the component can not process them.</li><li class="listitem"><span class="strong"><strong>stanza-listeners</strong></span> is a list of task names to load. Each task can read XMPP packets to send from different data sources. You can load as many listeners (tasks) as you need. Each task must read stanzas from different data sources.</li></ul></div><p>For each task from the stanza-listeners list there is a separate section with parameters for each task:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>active</strong></span> boolean switch allowing you to turn on/off the task without removing configuration completely.</li><li class="listitem"><span class="strong"><strong>class-name</strong></span> Java class name which implements the task. This class must extend tigase.server.ssender.SenderTask and it is loaded at runtime.</li><li class="listitem"><span class="strong"><strong>init-string</strong></span> is kind of data source connection string. For database it is just database connection string, for file system this is just a directory name. It may be even different for different tasks. The 2 tasks already implemented have some specific features: FileTask allows you to use wild-chars in directory/ file name specification and JDBCTask allows you to specify additional parameter at the end of JDBC connection string - database table name. For specific examples look at above config sections.</li><li class="listitem"><span class="strong"><strong>interval</strong></span> is a number which allows you to specify different interval in seconds for checking data source for each task.</li></ul></div><p><span class="strong"><strong>NOTE:</strong></span> Each task has own separate parameters list.</p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="oldVerSchemas.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_tigase_http_api.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Schema Updates&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Tigase HTTP API</td></tr></table></div></body></html>