<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tigase Clustering</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_using_tigase_applies_to_all_tigase_server_versions.html" title="Chapter&nbsp;9.&nbsp;Using Tigase - Applies to All Tigase Server Versions"><link rel="prev" href="tigaseAdvancedOptions.html" title="Tigase Advanced Options"><link rel="next" href="anonymousUsers.html" title="Anonymous Users &amp; Authentication"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Tigase Clustering</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tigaseAdvancedOptions.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;9.&nbsp;Using Tigase - Applies to All Tigase Server Versions</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="anonymousUsers.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tigaseClustering"></a>Tigase Clustering</h2></div></div></div><p>Tigase Clustering allows the use of a number of servers to be unified in delivering, from what a client or user sees, a single unified platform.
There are two typical reasons why clustering should be employed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">High Availability</p><pre class="literallayout">By using clustering, services can be provided with a high reliability and redundancy.  By using a network of multiple servers, content or services can be served on any of the clustered servers maintaining a consistent uptime without relying on one machine.</pre></li><li class="listitem"><p class="simpara">Load Balancing</p><pre class="literallayout">This type of cluster helps to distribute a workload over a number of servers to reduce bottlenecking from heavy resource loads on a particular server.</pre></li></ul></div><p>With Tigase, you don&#8217;t have to choose between either/or!</p><p><span class="strong"><strong>Tigase Clustering</strong></span> offers <span class="strong"><strong>Full Redundancy</strong></span> and <span class="strong"><strong>Automatic Load Balancing</strong></span> allowing addition of new nodes at runtime with a simple configuration.  All without a severe tax on resource consumption.</p><p>All basic components support clustering configuration, and some may be turned on or off.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuration_14"></a>Configuration</h3></div></div></div><p>To enable Clustering on Tigase servers, use the following line in your init.properties file:</p><pre class="programlisting">--cluster-mode=true</pre><p>That&#8217;s it!</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_custom_ports"></a>Custom Ports</h4></div></div></div><p>You can customize ports for the cluster component, just be sure that each clustered server also has the same settings so they can communicate.</p><pre class="programlisting">--cl-comp-ports=4250,3540</pre><p>You can fine tune each port configuration, however this is not typically needed.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_custom_port_configuration"></a>Custom Port Configuration</h5></div></div></div><p>Each port has it&#8217;s own details that can be manipulated VIA the following ports.  Again <span class="strong"><strong>THIS IS OPTIONAL</strong></span></p><pre class="programlisting">cl-comp/connections/4250/type[S]=accept
cl-comp/connections/4250/socket[S]=plain
cl-comp/connections/4250/ifc[s]=*
cl-comp/connections/4250/remote-host[S]=localhost
cl-comp/connections/4250/connections/tls/required[B]=false</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_multi_node_configuration"></a>Multi-node configuration</h4></div></div></div><p>Each node should have --cluster-mode=true enabled that you wish to connect to the cluster.  They will automatically discover other nodes to connect to VIA Server to Server traffic.
Nodes that are added or removed will be periodically updated.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_traffic_control"></a>Traffic Control</h4></div></div></div><p>You can customize the traffic going between clustered servers with a few options.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_cm_ht_traffic_throttling"></a>cm-ht-traffic-throttling</h5></div></div></div><p>This setting will control the number of bytes sent over non-user connections.  Namely, Server to Server or S2S connections.</p><pre class="programlisting">--cm-ht-traffic-throttling=xmpp:25k:0:disc,bin:200m:0:disc</pre><p>The format is as follows: {traffic-type}:{maximum-traffic}:{max-lifespan-traffic}:{action}
- <span class="strong"><strong>traffic-type</strong></span> Specifies the type of traffic controlled.  This can either be <span class="strong"><strong>XMPP</strong></span> or <span class="strong"><strong>bin</strong></span>.  XMPP limits the number of packets transferred, whereas bin limits the number of bytes transferred.
- <span class="strong"><strong>maximum-traffic</strong></span> Specifies how many bytes or packets may be sent within one minute.
- <span class="strong"><strong>max-lifespan-traffic</strong></span> Specifies how many bytes or packets may be sent within the lifetime of the connection. 0 means unlimited.
- <span class="strong"><strong>action</strong></span> Specifies the action to be taken which can be <span class="strong"><strong>disc</strong></span> which disconnects the connection, or <span class="strong"><strong>drop</strong></span> which will drop any data exceeding the thresholds.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_cm_see_other_host"></a>cm-see-other-host</h5></div></div></div><p>This allows the specific use of a load balancing mechanism by selecting SeeOtherHostIfc implementation.
For more details, see <a class="link" href="">Tigase Load Balancing</a> documentation.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_old_configuration_method"></a>Old configuration method</h3></div></div></div><p>While these options are still available these settings CAN be less reliable.  <span class="strong"><strong>Use ONLY if you need specific setups that cannot be accommodated by the automatic cluster mode</strong></span>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_specifying_specific_nodes"></a>Specifying Specific nodes</h4></div></div></div><p>You can still use the old method of specifying every node on each server.
Server 3 needs the following set</p><pre class="programlisting">--cluster-nodes=serv1.xmpp-test.org,serv2.xmpp-test.org</pre><p>Server 2 needs</p><pre class="programlisting">--cluster-nodes=serv1.xmpp-test.org,serv3.xmpp-test.org</pre><p>and so on&#8230;&#8203;</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_password_and_port_configuration"></a>Password and Port configuration</h5></div></div></div><p>You may specify a password and port to specific cluster servers if that is required.  To do so, you will need to add {password}:{port} to the domain, like this example:</p><pre class="programlisting">--cluster-nodes=serv1.xmpp-test.org:domainpass:5600</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_checking_cluster_connections"></a>Checking Cluster Connections</h3></div></div></div><p>After setting up clustering you may want to verify that the clusters are operational. Right now it can be done in two manners - first by checking that there are actual network connections established between cluster nodes. The other is to check internal status of the server.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_established_connections"></a>Established connections</h4></div></div></div><p>There are number of ways to check for opened connections, simplest one use command line. (Tigase uses port <span class="emphasis"><em>5277</em></span> for cluster connections)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Linux</li></ul></div><pre class="screen">$ lsof -iTCP:5277 -sTCP:ESTABLISHED -P -n</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Windows</li></ul></div><pre class="screen">C:\WINNT&gt;netstat -anp tcp | find ":5277 "</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_cluster_nodes_connected_using_xmpp"></a>Cluster nodes connected (using XMPP)</h4></div></div></div><p>Verifying clustering connectivity over XMPP protocol requires any XMPP client capable of <a class="link" href="http://xmpp.org/extensions/xep-0030.html" target="_top">XEP-0030: Service Discovery</a>. It&#8217;s essential to remember that only an administrator (a user whose JID is configured as administrative) has access.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_psi_xmpp_client_2"></a>Psi XMPP Client</h5></div></div></div><p>For the purpose of this guide a <a class="link" href="http://psi-im.org/" target="_top">Psi</a> client will be used. After successfully configuring and connecting to account with administrative privileges we need to access <span class="emphasis"><em>Service Discovery</em></span>, either from application menu or from context menu of the particular account account:</p><p><span class="inlinemediaobject"><img src="./images/monitoring_xmpp_1.png" width="233" alt="roster-discovery"></span></p><p>In the <span class="emphasis"><em>Service Discovery</em></span> window we need to find <span class="emphasis"><em>Cluster Connection Manager</em></span> component. After expanding the tree node for the component a list of all cluster nodes will be presented with the current status (either <span class="emphasis"><em>connected</em></span> or <span class="emphasis"><em>disconnected</em></span>). Node column will contain actual hostname of the cluster node:</p><p><span class="inlinemediaobject"><img src="./images/monitoring_clustering.png" width="558" alt="discovery-nodes"></span></p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tigaseAdvancedOptions.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_using_tigase_applies_to_all_tigase_server_versions.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="anonymousUsers.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Tigase Advanced Options&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Anonymous Users &amp; Authentication</td></tr></table></div></body></html>