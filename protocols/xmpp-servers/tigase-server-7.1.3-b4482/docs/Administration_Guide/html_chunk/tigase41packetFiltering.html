<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Packet Filtering</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_security_2.html" title="Chapter&nbsp;6.&nbsp;Security"><link rel="prev" href="customAuthentication.html" title="Custom Authentication Connectors"><link rel="next" href="accessControlList.html" title="Access Control Lists in Tigase"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Packet Filtering</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="customAuthentication.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;6.&nbsp;Security</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="accessControlList.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tigase41packetFiltering"></a>Packet Filtering</h2></div></div></div><p>Tigase offers different ways to filter XMPP packets flying through the server. The most common use for packet filtering is to restrict users from sending or receiving packets based on the sender or received address.</p><p>There are also different possible scenarios: time based filtering, content filtering, volume filtering and so on.</p><p>All pages in this section describe different filtering strategies.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="domainBasedPacketFiltering"></a>Domain Based Packet Filtering</h3></div></div></div><p>Domain based packet filtering is a simple filter allowing to restrict user communication based on the source/destination domain name. This is especially useful if we want to limit user communication within a single - own domain only or a list of domains.</p><p>A company might not wish to allow employers to chat during work hours with anybody in the world. A company may also have a few different domains used by different branches or departments. An administrator may restrict communication to a list of domains.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_introduction"></a>Introduction</h4></div></div></div><p>The restriction is on a per-user basis. So the administrator can set a different filtering rules for each user. There is also a per-domain configuration and global-installation setting (applied from most general to most specific, i.e. from installation to user).</p><p>Regular users can not change the settings. So this is not like a privacy list where the user control the filter. Domain filter can not be changed or controlled by the user. The system administrator can change the settings based on the company policy.</p><p>There are predefined rules for packet filtering:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><code class="literal">ALL</code> - user can send and receive packets from anybody.</li><li class="listitem"><code class="literal">LOCAL</code> - user can send and receive packets within the server installation only and all it&#8217;s virtual domains.</li><li class="listitem"><code class="literal">OWN</code> - user can send and receive packets within his own domains only</li><li class="listitem"><code class="literal">BLOCK</code> - user can&#8217;t communicate with anyone. This could be used as a means to temporarily disable account or domain.</li><li class="listitem"><code class="literal">LIST</code> - user can send and receive packets within listed domains only (i.e. <span class="emphasis"><em>whitelist</em></span>).</li><li class="listitem"><code class="literal">BLACKLIST</code> - user can communicate with everybody (like <code class="literal">ALL</code>), except contacts on listed domains.</li><li class="listitem"><code class="literal">CUSTOM</code> - user can communicate only within custom created rules set.</li></ol></div><p>Whitelist (<code class="literal">LIST</code>) and blacklist (<code class="literal">BLACKLIST</code>) settings are mutually exclusive, i.e. at any given point of time only one of them can be used.</p><p>Those rules applicable to particular users are stored in the user repository and are loaded for each user session. If there are no rules stored for a particular user server tries to apply rules for a VHost of particular user, and if there is no VHost filtering policy server uses global server configuration. If there is no filtering policy altogether server applies defaults based on following criteria:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">If this is <span class="strong"><strong>Anonymous</strong></span> user then <span class="strong"><strong>LOCAL</strong></span> rule is applied</li><li class="listitem">For all <span class="strong"><strong>other</strong></span> users <span class="strong"><strong>ALL</strong></span> rule is applied.</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_configuration"></a>Configuration</h4></div></div></div><p>Filtering is performed by the domain filter plugin which must be loaded at startup time. It is loaded by default if the plugins list is not set in the configuration file. However if you have a list of loaded plugins in the configuration file make sure <span class="strong"><strong>domain-filter</strong></span> is on the list.</p><p>There is no other configuration required for the plugin to work.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_administration_rules_management"></a>Administration, Rules Management</h4></div></div></div><p>Although controlling domain filtering rules is possible for each user separately, it is not practical for large installations. In most cases users are stored in the database and a third-party system keeps all the user information.</p><p>To change the rule for a single user you can use loadable administration scripts feature and load <a class="link" href="https://projects.tigase.org/projects/tigase-server/repository/revisions/master/entry/src/main/groovy/tigase/admin/UserDomainFilter.groovy" target="_top">UserDomainFilter.groovy</a> script. It enables modifying rules for a given user JID.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_implementation"></a>Implementation</h4></div></div></div><p>If you have a third party system which keeps and manages all user information than you probably have your own UserRepository implementation which allows the Tigase server to access user data. Filtering rules are loaded from user repository using following command:</p><pre class="programlisting">repo.getData(user_id, null, DomainFilter.ALLOWED_DOMAINS_KEY, null)
repo.getData(user_id, null, DomainFilter.ALLOWED_DOMAINS_LIST_KEY, null)</pre><p>Where <span class="strong"><strong>user_id</strong></span> is user Jabber ID without resource part, <span class="strong"><strong>DomainFilter.ALLOWED_DOMAINS_KEY</strong></span> is a property key: "allowed-domains". The user repository MUST return one of following only:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><code class="literal">ALL</code> - if the user is allowed to communicate with anybody</li><li class="listitem"><code class="literal">LOCAL</code> - if the user is allowed to communicate with users on the same server installation.</li><li class="listitem"><code class="literal">OWN</code> - if the user is allowed to communicate with users within his own domain only.</li><li class="listitem"><code class="literal">LIST</code> - list of domains within which the user is allowed to communicate with other users. No wild-cards are supported. User&#8217;s own domain should be included too.</li><li class="listitem"><code class="literal">BLACKLIST</code> - list of domains within which the user is NOT allowed to communicate with other users. No wild-cards are supported. User&#8217;s own domain should NOT be included.</li><li class="listitem"><code class="literal">CUSTOM</code> - list of rules defining custom communication permissions (server processes stanza according to first matched rule, similar to XEP-0016) in the following format:</li></ol></div><pre class="screen">ruleSet = rule1;rule2;ruleX;

rule = order_number|policy|UID_type[|UID]

order_number = any integer;
policy = (allow|deny);
UID_type = [jid|domain|all];
UID = user JID or domain, for example pubsub@test.com; if UID_type is ALL then this is ignored.</pre><p>For example:</p><pre class="screen">1|allow|self;
2|allow|jid|admin@test2.com;
3|allow|jid|pubsub@test.com;
4|deny|all;</pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><code class="literal">null</code> - a java null if there are no settings for the user.</li></ol></div><p>In case of <code class="literal">LIST</code> and <code class="literal">BLACKLIST</code> filtering options, it&#8217;s essential to provide list of domains for the whitelisting/blacklisting. <span class="strong"><strong>DomainFilter.ALLOWED_DOMAINS_LIST_KEY</strong></span> is a property key: "allowed-domains-list". The user repository MUST return semicolon separated list of domains: <code class="literal">domain1.com;domain2.com,domain3.org</code></p><p>The filtering is performed by the <a class="link" href="https://projects.tigase.org/projects/tigase-server/repository/revisions/master/entry/src/main/java/tigase/xmpp/impl/DomainFilter.java" target="_top"><code class="literal">tigase.xmpp.impl.DomainFilter</code></a> plugin. Please refer to source code for more implementation details.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="customAuthentication.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_security_2.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="accessControlList.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Custom Authentication Connectors&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Access Control Lists in Tigase</td></tr></table></div></body></html>