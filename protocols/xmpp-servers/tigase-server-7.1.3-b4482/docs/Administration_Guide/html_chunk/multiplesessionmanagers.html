<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Two or More SessionManagers</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_using_tigase_applies_to_all_tigase_server_versions.html" title="Chapter&nbsp;9.&nbsp;Using Tigase - Applies to All Tigase Server Versions"><link rel="prev" href="Pymsn-t.html" title="Tigase and PyMSN-t Transport"><link rel="next" href="watchdog.html" title="Watchdog"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Two or More SessionManagers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Pymsn-t.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;9.&nbsp;Using Tigase - Applies to All Tigase Server Versions</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="watchdog.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multiplesessionmanagers"></a>Two or More SessionManagers</h2></div></div></div><p>In the most cases just one SessionManager object is used for Tigase server installation. A single SM can handle multiple virtual domains with separate SSL certificates for each domain.</p><p>Sometimes, however you need a different configuration for each domain. For example, if you wish to use a separate database for a selected domain or you need a different set of plugins for each domain. For one domain you might want to allow user registration via XMPP and for another you might want to disable this feature.  In this case you need to load more than one session manager.</p><p>For Tigase, this is not a problem. You just need to add another component in the configuration and adjust default settings.</p><p>The question is now how does Tigase server know which session manager it has to forward packets received from the network? Keep in mind, there is only one component responsible for handling client connections. So it needs to know which session manager is the receiver for certain packets.  Of course you can set domain names in session manager too, but that may not be enough. Tigase server supports cluster mode configuration where session manager can be run on a separate machine. So packet routings rules cannot be controlled by just the domain name. Therefore client connection manager (<span class="strong"><strong>c2s</strong></span>) must know which session manager is responsible for handling the packet received from the network.</p><p>To solve the problem a <span class="strong"><strong>routing</strong></span> concept has been introduced. You can define packet routings based on the domain name set during XMPP stream initialization.  Each time the <span class="strong"><strong>c2s</strong></span> component receives packet from the network it tries to resolve destination component for the packet based on the current routings table. If you look in you server XML configuration file and search for <span class="strong"><strong>c2s</strong></span> configuration section you can find routing node. Default configuration for the routing table is quite simple, just a single regular expression:</p><pre class="programlisting">   &lt;node name="routings"&gt;
    &lt;map&gt;
     &lt;entry key=".+" type="String" value="sess-man%40tigase.org"/&gt;
     &lt;entry key="multi-mode" type="Boolean" value="true"/&gt;
    &lt;/map&gt;
   &lt;/node&gt;</pre><p>As you can see this routing table forwards all packets to a single destination - the session manager located on the <span class="strong"><strong>tigase.org</strong></span> server.</p><p>Now let&#8217;s say we have two session managers, each of them is responsible for a separate domain.sm1@tigase.org handling requests for <span class="strong"><strong>tigase.org</strong></span> and sm2@tigase.net handling requests for domain <span class="strong"><strong>tigase.net</strong></span>. The modifications to the configuration to properly spread the traffic between the two session managers would look like this:</p><pre class="programlisting">   &lt;node name="routings"&gt;
    &lt;map&gt;
     &lt;entry key="tigase.org" type="String" value="sm1%40tigase.org"/&gt;
     &lt;entry key="tigase.net" type="String" value="sm2%40tigase.net"/&gt;
     &lt;entry key="multi-mode" type="Boolean" value="true"/&gt;
    &lt;/map&gt;
   &lt;/node&gt;</pre><p>Please remember that a key is a regular expression in Java style: <a class="link" href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html" target="_top">Pattern.html</a>. You can match more than a single domain with the key, for example: <span class="emphasis"><em>tigase.+</em></span> to match all domains starting with <span class="strong"><strong>tigase</strong></span>. The expression, however won&#8217;t match domain: <span class="strong"><strong>xmpp.tigase.org</strong></span>. To match this domain the expression would need to be: <span class="emphasis"><em>.+tigase.+</em></span>.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Pymsn-t.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_using_tigase_applies_to_all_tigase_server_versions.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="watchdog.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Tigase and PyMSN-t Transport&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Watchdog</td></tr></table></div></body></html>