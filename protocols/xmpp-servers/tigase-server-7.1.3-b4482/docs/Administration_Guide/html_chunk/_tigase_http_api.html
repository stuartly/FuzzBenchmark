<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tigase HTTP API</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="loadComponent.html" title="Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component"><link rel="prev" href="loadComponent.html" title="Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component"><link rel="next" href="messageArchiving.html" title="Message Archiving Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Tigase HTTP API</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="loadComponent.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="messageArchiving.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_tigase_http_api"></a>Tigase HTTP API</h2></div></div></div><p>Welcome to the Tigase HTTP API users guide.  The HTTP API allows you to manage, configure, chat, and send commands to Tigase server using a simple, easy-to-use interface right from your browser!
We will guide you through setup, running, and going through some features of the HTTP API.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_requirements"></a>Requirements</h3></div></div></div><p>The HTTP API Requires Tigase version v5.0.3 but we recommend using the latest version of Tigase which will give you the easiest setup and functionality.
Current versions of Tigase include most of the required files needed to run the API, however you will need to add one more library: servlet-api-3.1.jar which is available <a class="link" href="https://projects.tigase.org/attachments/download/1504/servlet-api-3.1.jar" target="_top">Here</a>.
Place that file in your /jars directory and you&#8217;re all setup and good to go.</p><p><span class="strong"><strong>Please note, earlier versions of Tigase installer may have not included another required file: javax.servlet-api.jar</strong></span></p><p>This file is included in the archive distributions, and may be extracted to the /jars directory from there.</p><p>For older versions of the API, please see <a class="link" href="https://projects.tigase.org/projects/tigase-http-api/wiki/Dependencies" target="_top">the Tigase HTTP API Wiki</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_configuration"></a>Setup &amp; Configuration</h3></div></div></div><p>Once all the requirements in place, all you need to do is add the following lines to Tigase&#8217;s init.properties file:</p><pre class="programlisting">--comp-name-3=http
--comp-class-3=tigase.http.HttpMessageReceiver</pre><p>Note that the class and name number is not important, so long as you don&#8217;t have anything else with the same number.</p><p>With this default configuration Tigase will attempt to start an http server at port 8080 and run the default modules such as RestModule which will add context for the REST API in /rest path.
RestModule will also load all groovy scripts located in scripts/rest/xxx directories and it will bind it to proper action for the /rest/xxx/ paths.  More than one directory can be used, think of xxx as a wildcard.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_advanced_configuration_2"></a>Advanced Configuration</h4></div></div></div><p>The HTTP component has a variety of configuration options, lets see them in detail here</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="httpCompProp"></a>Component Properties</h5></div></div></div><p>Please note, for settings mentioning {compname} replace them with the exact text found as --comp-name, which may be http, rest, or something you have set custom in init.properties.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">{compname}/http/ports[i]=8088,8096</span></dt><dd>Sets a comma separated list of ports on which the HTTP server listens for connections.  8080 is set by default.</dd><dt><span class="term">{compname}/2222/socket=ssl</span></dt><dd>Sets the port you wish the HTTP server to listen to for HTTPS connections to 2222</dd><dt><span class="term">{compname}/4096/domain=example.com</span></dt><dd>Sets 4096 as the port number you want to listen to HTTPS connections <span class="strong"><strong>AND</strong></span> set the domain name of the SSL certificate from Tigase XMPP server certificate store to be used.</dd><dt><span class="term">{compname}/server-class=</span></dt><dd><p class="simpara">Sets the name of the class used to manage the HTTP server. The following names may be used</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>tigase.http.jetty.JettyStandaloneHttpServer</strong></span> - starts standalone Jetty HTTP Server instance <span class="strong"><strong>(requires Tigase HTTP API - Jetty HTTP Server)</strong></span></li><li class="listitem"><span class="strong"><strong>tigase.http.jetty.JettyOSGiHttpServer</strong></span> - uses Jetty HTTP Server instance available as OSGi service (may be used only in OSGi envoirment) <span class="strong"><strong>(requires Tigase HTTP API - Jetty HTTP Server)</strong></span></li><li class="listitem"><span class="strong"><strong>tigase.http.java.JavaStandaloneHttpServer</strong></span> - uses HttpServer provided by Java JDK to start standalone HTTP server (may not work on JDK from every JDK provider)</li></ul></div></dd><dt><span class="term">{compname}/http/port</span></dt><dd>An older version of the /ports[i] setting, it is still supported, but expect to be phased out.</dd><dt><span class="term">{compname}/setup/admin-credentials</span></dt><dd>Sets a user and password combination that can access the web installer setup pages. By default administrator JIDs listed in --admins property are granted access, however you may specifiy a specific user and password to give access in addition to those JIDs.
Format is [username:password] So for example, <span class="emphasis"><em>http/setup/admin-credentials=admin:password</em></span>
Note that this stores the information in <span class="strong"><strong>plaintext on init.properties file</strong></span>, and <span class="strong"><strong>this is an optional setting</strong></span>.</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_modules"></a>Modules</h5></div></div></div><p>Tigase HTTP API component provides functionalities as modules which may be enabled or disabled and configured separately.
Common settings for modules which can be passed in component properties in following format component_name/module_id/module_setting:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">active[B]= Values true/false to enable or disable module</li><li class="listitem">context-path= Path of HTTP context under which module should be available</li><li class="listitem">vhosts[s]= Comma separated list of virtual hosts under which the module should be availble. If this setting is not set, the HTTP module will be available for all virtual hosts.</li></ul></div><p>With those ideas in mind, lets look at the available modules for the HTTP API.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_rest_module"></a>Rest Module</h6></div></div></div><p>This module provides support for the REST API.  enable it by using this line in the init.properties file:</p><pre class="screen">http/RestModule/active[B]=true</pre><p>Assuming that comp-name for the class is http</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">rest-scripts-dir=</span></dt><dd>Path to directory containing scripts processing REST requests.  By default this directory is scripts/rest</dd><dt><span class="term">api-keys[s]=</span></dt><dd>Comma separated list of strings which would be possible to use as keys to pass api-key parameter to request an authorization to execute.
If nothing is passed, then no request will be allowed.  To allow any request, this property needs to be set to open_access.</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_dns_webservice_module"></a>DNS Webservice Module</h6></div></div></div><p>dns-webservice module provides support for resolution of DNS names using the HTTP protocol.  This might be useful for web applications that need to resolve DNS address to a specific IP.  For example, discover IP and port of WebSocket service to use to connect to XMPP server.</p><p>To activate this module, use the following line;</p><pre class="programlisting">http/dns-webservice/active[B]=true</pre><p>Assuming that comp-name for the class is http</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_use_of_the_http_api"></a>Use of the HTTP API</h3></div></div></div><p>To begin using the HTTP API, point a browser to the following url
<a class="link" href="http://your.server.domain:8080/ui/" target="_top">http://your.server.domain:8080/ui/</a> and you will be presented with the following image to login with.</p><p><span class="inlinemediaobject"><img src="./images/http-login.jpg" alt="http-login"></span></p><p>Use your admin-level XMPP id and it&#8217;s password to login.  Please use bare JID for logins.</p><p><span class="strong"><strong>NOTE: Normal users can login here as well to use chat and basic functions, but they will not have admin privileges as shown in this guide</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_browser_interface_walk_through"></a>Browser interface walk-through</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_chat"></a>Chat</h4></div></div></div><p>Chat is the first window that you will see after logging in.  It&#8217;s quite bare here since there is no roster to speak of.  If you had a roster, users would be shown.
Lets add a user.  Click the user add icon, and then fill in the fields below.</p><p><span class="inlinemediaobject"><img src="./images/http-add-new.jpg" alt="http-add-new"></span></p><p>Once both users have added and authorized each other&#8217;s roster listing, the users and groups will be shown on the left, with the right side being used for chat functionality.</p><p><span class="inlinemediaobject"><img src="./images/http-chat.jpg" alt="http-chat"></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_discovery"></a>Discovery</h4></div></div></div><p>The Discovery tab encapsulates the service discovery function of XMPP servers, and will provide a list of available services. Clicking on the service will give you options for executing commands, checking settings, MUC rooms and more.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_management"></a>Management</h4></div></div></div><p>The Management tab is your administration and settings tool for the XMPP server.  Here you can change settings, add and remove users, send server-wide notifications, write and execute scripts, and even obtain server statistics at a glance.</p><p><span class="strong"><strong>NOTE: some changes to settings may be instant, and others require a server restart</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_statistics"></a>Statistics</h4></div></div></div><p>The statistics tab lists all running components in the server.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_http_api_scripting"></a>HTTP API Scripting</h3></div></div></div><p>Scripts in the HTTP API component are used for processing all of requests.</p><p>To add a new action to HTTP API component you need to create a script in Groovy in which there is an implementation of class extending tigase.http.rest.Handler class. The URI of the script will be created from the location of script in scripts folder.
For example, if TestHandler script with regular a expression will be set to /test and will be placed in scripts/rest/tested, the handler will be called for following URI /rest/tested/test.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_properties"></a>Properties</h4></div></div></div><p>If you are extending classes, you will need to set the following properties:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">regex</span></dt><dd><p class="simpara">regular expression which is used to match request URI and parse parameters embedded in URI, example below:</p><pre class="literallayout">/\/([^@\/]+)@([^@\/]+)/</pre></dd><dt><span class="term">requiredRole</span></dt><dd>Role of the user required to be able to access this URI. Available values: null, "user", "admin". If requiredRole is not null, authentication will be required.</dd><dt><span class="term">isAsync</span></dt><dd>If set to true, it will be possible to wait for results, perhaps waiting for an IQ stanza to send results.</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_properties_containing_closures"></a>Properties Containing Closures</h4></div></div></div><p>Extended class should also set closures for one or more of the following properties: execGet, execPut, execPost, and execDelete depending on which HTTP action or actions you need to support for the following URI. Each closure <span class="strong"><strong>has dynamic arguments lists</strong></span>.
Below is a list of arguments passed to closure which describes how and when the list of arguments change.</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><span class="strong"><strong>service</strong></span>:
Implementation of Service interface, used to access database or send/recieve XMPP stanzas.</li><li class="listitem"><span class="strong"><strong>callback</strong></span>:
Closure which needs to be called to return data. Accepts only one argument of type String,byte[],Map. If data is type of Map it will be encoded to JSON or XML depending on 'Content-Type' header.</li><li class="listitem"><span class="strong"><strong>user</strong></span>:
Will be passed only if requiredRole is not null. <span class="strong"><strong>In other cases this argument will not be in arguments list!</strong></span></li><li class="listitem"><span class="strong"><strong>content</strong></span>:
Parsed content of the request. <span class="strong"><strong>Will not be in arguments list if Content-Length of request is empty</strong></span>. If Content-Type is of XML or JSON type, type returned as Map.  Otherwise it will be an instance of HttpServletRequest.</li><li class="listitem"><span class="strong"><strong>x</strong></span>:
Additional arguments passed to callback are groups from regular expression matching URI. <span class="strong"><strong>Groups are not passed as list, but are added to a list of arguments as next arguments</strong></span>.</li></ol></div><p>If the property for corresponding HTTP action is not set, the component will return a 404 HTTP error.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="restAPI"></a>REST API &amp; HTTP Guide</h3></div></div></div><p>This component covers both REST API as well as basic HTTP component configuration.
REST stands for REpresentational State Transfer which is a stateless communication method that in our case passes commands using HTTP GET, PUT, POST, and DELETE commands to resources within the Tigase server.
Although REST uses HTTP to receive commands, REST itself is not intended for use in a browser.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_setup_configuration_2"></a>Setup &amp; Configuration</h4></div></div></div><p>Tigase&#8217;s REST component requires the following in classpath</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">servlet-api-3.1.jar</li></ul></div><p>If you have installed Tigase v7.1.0 or later, the jar is already installed.  If you are using an older version of Tigase, you may download the file from <a class="link" href="https://projects.tigase.org/attachments/download/1504/servlet-api-3.1.jar" target="_top">this link</a>.
Once this is installed, you will also need to add the following lines in your init.properties file to enable the HTTP component.</p><pre class="programlisting">--comp-name-4=http
--comp-class-4=tigase.http.HttpMessageReceiver</pre><p>In this default configuration, Tigase will try to start a standalone Jetty HTTP server at port 8080 and start up the default modules, including RestModule which will add context for REST API in the /rest path. RestModule will also load all groovy scripts located in scripts/rest/* directories and will bind them to proper actions for the /rest/* paths.</p><p><span class="strong"><strong>NOTE:</strong></span> Scripts that handle HTTP requests are available in the component repository in src/scriopts/groovy/tigase/rest/ directory.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_component_properties"></a>Component Properties</h5></div></div></div><p>Here are some additional properties for the HttpMessageReceiver component that can be set in the init.properties file.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">{compname}/http/ports[i]= - Sets a comma separated list of ports on which the HTTP server will listen for connections. Default is 8080.</li><li class="listitem">{compname}/*********/socket=ssl - Sets the port for SSL connections, replace <span class="marked">#</span> with the port number of your choice.</li><li class="listitem">{compname}/*********/domain=example.com - This sets the domain name of the SSL certificate from Tigase XMPP certificate store, also sets the port to <span class="marked">#</span> to listen for HTTPS connections.</li><li class="listitem"><p class="simpara">{compname}/server-class= - Sets the name of the class used to manage the HTTP server. Currently there are the following options:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">tigase.http.JettyStandaloneHttpServer - Starts standalone Jetty HTTP Server instance <span class="strong"><strong>(requires Tigase HTTP API - Jetty HTTP Server)</strong></span></li><li class="listitem">tigase.http.jetty.JettyOSGIHttpServer - Uses Jetty HTTP Server instance available as OSGi service (may be used only in OSGi envoirment) <span class="strong"><strong>(require Tigase HTTP API - Jetty HTTP Server)</strong></span></li><li class="listitem">tigase.http.java.JavaStandaloneHttpServer - Uses HttpServer provided by Java JDK to start standalone HTTP server (may not work on JDK from every JDK provider).</li><li class="listitem">{compname}/http/threads= - Sets the number of threads available for HTTP component. Default is 4.</li><li class="listitem">{compname}/http/request-timeout= - Sets the timeout time in ms for threads to close on inactive connections. Default is 60 seconds.</li></ol></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_modules_2"></a>Modules</h5></div></div></div><p>Tigase&#8217;s REST Component comes with two modules that can be enabled, disabled, and configured separately.
Common settings for modules for component properties are used in the following format: component_name/module_id/module_setting/
the following settings are available for both listed modules:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">active[B] - Boolean values true/false to enable or disable the module.</li><li class="listitem">context-path - Path of HTTP context under which the module should be available.</li><li class="listitem">vhosts[s] - Comma separated list of virtual hosts for which the module should be available. If not configured, the module will be available for all vhosts.</li></ul></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_rest_module_2"></a>Rest Module</h6></div></div></div><p>This is the Module that provides support for the REST API.
Available properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">rest-scripts-dir - Provides ability to specify path to scripts processing REST requests if you do not wish to use default (scripts/rest).</li><li class="listitem">api-keys[s] - Comma separated list of strings which would be possible to use as keys to pass api-key parameter to request authorization for request execution. If nothing is passed, then no request will be allowed. To allow any request, this property needs to be set using the following:</li></ul></div><pre class="screen">http/rest/api-keys[s]=open_access</pre><p>You may set api-keys to any string you wish, however, when you make requests of the HTTP API service, the included API key must match <span class="strong"><strong>EXACTLY</strong></span>. Keep the API key to ASCII characters to maintain compatibility. For example, if you were to set the following API key:</p><pre class="screen">http/rest/api-key[s]=a7D2dm3lps138w</pre><p>Requests made to the HTTP service must conclude with the same key: http://localhost:8080/rest/adhoc/sess-man@domain.com?api-key=a7D2dm3lps138w</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_dns_webservice"></a>dns-webservice</h6></div></div></div><p>This module provides resolution of DNS names using HTTP protocol. This particular module might be useful for web applications that need to resolve the DNS address to a particular IP. For example to help discover the IP and port of WebSocket services used to connect to the XMPP server.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_usage_examples"></a>Usage Examples</h4></div></div></div><p>Here are some examples using the HTTP API using available scripts.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_retrieving_list_of_available_ad_hoc_commands"></a>Retrieving list of available ad-hoc commands</h5></div></div></div><p>To retrieve a list of available commands, REST needs to use the GET method from the following resource: /rest/adhoc/sess-man@domain.com. This provides a list of available adhoc commands from the <a class="link" href="mailto:sess-man@domain.com" target="_top">sess-man@domain.com</a> resource. This can be change to any bare JID that you wish to get commands from so it can be a MUC room, monitor component, or in this case, the Session manager.
With the server running, lets connect to the address http://localhost:8080/rest/ and the following resource /adhoc/sess-man@domain.com which will retrieve a list of all ad-hoc commands available at <a class="link" href="mailto:sess-man@domain.com" target="_top">sess-man@domain.com</a>. This particular action is protected by authentication using HTTP basic authentication so valid credentials are necessary. User credentials are available in the Tigase&#8217;s user database installation, so use the bare JID and password of an admin-authorized account to conduct this activity.
The result will be an XML format output of available commands, similar to an IQ stanza, below an example of that result.</p><pre class="programlisting">&lt;items&gt;
  &lt;item&gt;
    &lt;jid&gt;sess-man@domain.com&lt;/jid&gt;
    &lt;node&gt;http://jabber.org/protocol/admin#get-active-users&lt;/node&gt;
    &lt;name&gt;Get list of active users&lt;/name&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;jid&gt;sess-man@domain.com&lt;/jid&gt;
    &lt;node&gt;del-script&lt;/node&gt;
    &lt;name&gt;Remove command script&lt;/name&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;jid&gt;sess-man@domain.com&lt;/jid&gt;
    &lt;node&gt;add-script&lt;/node&gt;
    &lt;name&gt;New command script&lt;/name&gt;
  &lt;/item&gt;
&lt;/items&gt;</pre><p>There is also the ability to return a JSON formatted result. To achieve this, you need to pass Content-Type: application/json to the HTTP header of the request, or add the type parameter and set it to application/json setting.  An example of a JSON result is below.</p><pre class="programlisting">{
    "items": [
        {
            "jid": "sess-man@domain.com",
            "node": "http://jabber.org/protocol/admin#get-active-users",
            "name": "Get list of active users"
        },
        {
            "jid": "sess-man@domain.com",
            "node": "del-script",
            "name": "Remove command script"
        },
        {
            "jid": "sess-man@domain.com",
            "node": "add-script",
            "name": "New command script"
        }
    ]
}</pre><p>Again, either of these methods can be used on any component with available ad-hoc commands. Feel free to experiment and see what options are available for each component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_executing_ad_hoc_commands"></a>Executing ad-hoc commands</h5></div></div></div><p>Once you have found a command you wish to use, you can send that command using the HTTP POST method. In this example, lets request a list of active users as seen in the previous section. <span class="strong"><strong>NOTE:</strong></span> like the previous example, these commands require basic HTTP authentication.</p><p>The following command is sent to http://localhost:8080/rest/adhoc/sess-man@domain.com</p><pre class="programlisting">&lt;command&gt;
  &lt;node&gt;http://jabber.org/protocol/admin#get-active-users&lt;/node&gt;
  &lt;fields&gt;
    &lt;item&gt;
      &lt;var&gt;domainjid&lt;/var&gt;
      &lt;value&gt;domain.com&lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;var&gt;max_items&lt;/var&gt;
      &lt;value&gt;25&lt;/value&gt;
    &lt;/item&gt;
  &lt;/fields&gt;
&lt;/command&gt;</pre><p>This particular command reqiures the three fields &lt;node&gt;, domainjid, and max_items. These three values are the node for the command, as returned in available commands, the domain results are to be returned from, and the maximum number of results. Keep in mind that Content-type: text/xml must be passed to the HTTP header to get an XML result. Not doing so may yield errors or incomprehensible results.
The result for this command will look like this:</p><pre class="programlisting">&lt;command&gt;
  &lt;jid&gt;sess-man@domain.com&lt;/jid&gt;
  &lt;node&gt;http://jabber.org/protocol/admin#get-active-users&lt;/node&gt;
  &lt;fields&gt;
    &lt;item&gt;
      &lt;var&gt;Users: 3&lt;/var&gt;
      &lt;label&gt;text-multi&lt;/label&gt;
      &lt;value&gt;admin@domain.com&lt;/value&gt;
      &lt;value&gt;user1@domain.com&lt;/value&gt;
      &lt;value&gt;morbo@domain.com&lt;/value&gt;
    &lt;/item&gt;
  &lt;/fields&gt;
&lt;/command&gt;</pre><p>Similar results can be sent and received using JSON in a similar fashion. Again, be sure to set ContentType: application/json in the header or default settings.</p><pre class="programlisting">{
  "command" : {
    "node" : "http://jabber.org/protocol/admin#get-active-users",
    "fields" : [
      {
        "var" : "domainjid",
        "value" : "subdomain.domain.com"
      },
      {
        "var" : "max_items",
        "value" : "25"
      }
    ]
  }
}</pre><p>The results will look quite similar to the XML results:</p><pre class="programlisting">{
    "command": {
        "jid": "sess-man@domain.com",
        "node": "http://jabber.org/protocol/admin#get-active-users",
        "fields": [
            {
                "var": "Users: 2",
                "label": "text-multi",
                "value": [
                  "minion1@subdomain.domain.com",
                  "overadmin@subdomain.domain.com"
                ]
            }
        ]
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_sending_any_xmpp_stanza"></a>Sending any XMPP Stanza</h5></div></div></div><p>XMPP messages or any other XMPP stanza can be sent using this API by sending HTTP POST request on <a class="link" href="http://localhost:8080/rest/stream/api-key=API_KEY" target="_top">http://localhost:8080/rest/stream/api-key=API_KEY</a> with a serialized XMPP stanza as content, where API_KEY is the API key specified in the init.properties file.
Each request needs to be authorized by sending a valid administrator JID and password as a user/password of BASIC HTTP authorization method.  The content of the HTTP request should be encoded in UTF-8 and Content-Type should be set to application/xml.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_handling_of_request"></a>Handling of request</h6></div></div></div><p>If no from attribute is set in the stanza, the HTTP API component will supplant it&#8217;s JID instead, however if one is set it will be preserved.  However, in iq stanzas, if no from attribute is set the HTTP response content will be sent back as a response.  Successful requests will return a HTTP response code of 200.</p><p><span class="strong"><strong>Examples:</strong></span>
Any of these examples must be sent as an HTTP POST request to /rest/stream/?api-key=API_KEY of the HTTP API component.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_sending_xmpp_message_with_from_set_to_http_api_component_a_full_jid"></a>Sending XMPP message with from set to HTTP API component a full JID</h6></div></div></div><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_sending_xmpp_message_with_from_set_to_http_api_component_with_a_bare_jid"></a>Sending XMPP message with from set to HTTP API component with a bare JID</h6></div></div></div><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" to="test@example.com"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_sending_xmpp_message_with_from_set_to_a_specified_jid_to_a_full_jid"></a>Sending XMPP message with from set to a specified JID to a full JID</h6></div></div></div><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" from="sender@example.com" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_sending_messages_through_rest"></a>Sending messages through REST</h4></div></div></div><p>You can also send messages, or really any XMPP stanza to users and components through REST API. Sending XMPP messages or stanzas using HTTP is realized as a groovy script bundled in the installation package from v7.0.2. If you want to be sure your current install supports this feature, check for the presence of Stream.groovy file in the scripts/rest/stream/ directory.</p><p>As in other examples, be sure that you have the following line in your init.properties:</p><pre class="programlisting">http/rest/api-keys[s]=test_key</pre><p>You may also opt to have open_access set to disable API key parameter.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_usage"></a>Usage</h5></div></div></div><p>Using the HTTP POST method, XMPP stanzas can be sent using the built in HTTP API. In a local installation, the request can be sent to http://localhost:8080/rest/stream/?api-key=API_KEY with a seralized XMPP stanza as content, where API_KEY is the API key for HTTP API which is set in etc/init.properties as rest/api-keys[s].  In the case we laid out, it would be test_key. Because XMPP uses XML for formatting, all content in these requests <span class="strong"><strong>MUST</strong></span> be encoded in UTF-8 and Content-type must be set to application/xml.
Lets take a look at some examples.</p><p><span class="emphasis"><em>In all examples the data is sent as an HTTP POST request to /rest/stream/?api-key=test-key.</em></span></p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_send_xmpp_stanza_with_from_set_to_http_api_component_to_bare_jid"></a>Send XMPP stanza with from set to HTTP API component to bare JID</h6></div></div></div><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre><p>Once this message is sent, the Groovy script adds the remaining information automatically, and the following is what is receieved by <a class="link" href="mailto:test@example.com" target="_top">test@example.com</a>/resource-1.</p><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" from:"http@example.com" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre><p>As you can see, the HTTP component is automatically populated as the sender.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_send_xmpp_stanza_with_from_set_to_http_api_component_to_full_jid"></a>Send XMPP stanza with from set to HTTP API component to full JID</h6></div></div></div><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" to="test@example.com"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre><p>The syntax and formatting is the same, with the recepiant messaging being exactly the same.</p><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" from:"http@example.com" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_send_xmpp_stanza_with_from_set_to_specified_jid"></a>Send XMPP stanza with from set to specified JID</h6></div></div></div><p>You may specify any JID that is registered in the server to send the stanza, ones that use a name that is not registered will return an error.</p><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" from="sender@example.com" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre><p>Ends with the result being somewhat customized.</p><pre class="programlisting">&lt;message xmlns="jabber:client" type="chat" from:"sender@example.com" to="test@example.com/resource-1"&gt;
    &lt;body&gt;Example message 1&lt;/body&gt;
&lt;/message&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="avatarRetrievalRequests"></a>Avatar retrieval requests</h5></div></div></div><p>There are different formats for avatar retrieval depending on how they are stored, see below for the resources for each type of avatar.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">/rest/avatar/user@domain - which returns first avatar found (PEP, VCard4 or VCardTemp in this order)</li><li class="listitem">/rest/avatar/user@domain/avatar - which returns PEP avatar</li><li class="listitem">/rest/avatar/user@domain/vcard4 - which returns avatar from VCard4</li><li class="listitem">/rest/avatar/user@domain/vcard-temp - which returns avatar from VCardTemp</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_setting_http_api_privacy_rules"></a>Setting HTTP API Privacy Rules</h4></div></div></div><p>The HTTP API component has settings that allow you to specify who is allowed to use the HTTP API interface, keeping unauthorized users from accessing the feature. This feature is implemented using a Groovy admin ad-hoc stript for the Session Manager component. As a result of this method, it will be avaiulable to execution using the default GTTP API componene capability to execute the script. The actual work of filtering, however, will be conducted by the DomainFilter plugin.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="getUserInfoREST"></a>New Rest API added to obtain a JID login time</h4></div></div></div><p>GetUserInfo command has been expanded to obtain user login and logout times in addition to standard information. To obtain the information, send a POST request to <a class="link" href="http://xmpp.domain.net:8080/rest/adhoc/sess-man@xmpp.domain.net?api-key=test-api-key" target="_top">http://xmpp.domain.net:8080/rest/adhoc/sess-man@xmpp.domain.net?api-key=test-api-key</a> with the following:</p><pre class="programlisting">&lt;command&gt;
  &lt;node&gt;get-user-info&lt;/node&gt;
  &lt;fields&gt;
    &lt;item&gt;
      &lt;var&gt;accountjid&lt;/var&gt;
      &lt;value&gt;user@xmpp.domain.net&lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;var&gt;Show connected resources in table&lt;/var&gt;
      &lt;value&gt;true&lt;/value&gt;
    &lt;/item&gt;
  &lt;/fields&gt;
&lt;/command&gt;</pre><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_configuration_4"></a>Configuration</h5></div></div></div><p>The HTTP API privacy scipt is loaded automatically. DomainFilter is a default plugin loaded by Tigase on startup. This means there is very little you need to do to have this running.
Again, you may define a custom API key to limit access using the following line in init.properties</p><pre class="programlisting">http/rest/api-keys[s]=test_key</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_usage_2"></a>Usage</h5></div></div></div><p>Setting privacy rules can be done by sending a POST request to the session manager using this address: http://localhost:8080/rest/sess-man@domain.com?api-key=test_key</p><pre class="programlisting">&lt;command&gt;
  &lt;node&gt;user-domain-perm&lt;/node&gt;
  &lt;fields&gt;
    &lt;item&gt;
      &lt;var&gt;jid&lt;/var&gt;
      &lt;value&gt;user@domain.com&lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;var&gt;fiteringPolicy&lt;/var&gt;
      &lt;value&gt;CUSTOM&lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;var&gt;filteringList&lt;/var&gt;
      &lt;value&gt;
         1|allow|self;
         2|allow|jid|admin@test2.com;
         3|allow|jid|pubsub@test.com;
         4|deny|all;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/fields&gt;
&lt;/command&gt;</pre><p>Here all parameters are passed to be excuted by ad-hot command.  Using the user-domain-perm node we were able to add jids to a CUSTOM filter. Here is a brief breakdown:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">jid denotes which JID the settings will be applied too.</li><li class="listitem">filteringPolicy - This uses a CUSTOM type list that allows for multi-item list of custom processing rules.</li><li class="listitem">filteringLise - This is a multi-item list, semi-colon delimited, where each line denotes one item with a rule in this format: +order_number|policy|UID_type[|UID]:</li><li class="listitem">order_number can be any integer, as long as no numbers repeat.</li><li class="listitem">policy can either allow or deny.</li><li class="listitem">UID_type is the User ID Type, can be jid, domain, or all.</li><li class="listitem">UID is the user JID affected. If UID_type is set to all then this will be ignored.</li></ul></div><p>These ad-hoc commands replicate settings found in <a class="link" href="tigase41packetFiltering.html#domainBasedPacketFiltering" title="Domain Based Packet Filtering">Domain Based Packet Filtering</a> in the admin guide. They may also be influenced by the <a class="link" href="http://docs.tigase.org/tigase-server-Properties_Guide/html?#domainFilterPolicy" target="_top">--domain-filter-policy</a> property of init.properties.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_scripting"></a>Scripting</h4></div></div></div><p>As you can see from the above commands, Tigase uses pre-defined scripts for processing of all requests in HTTP API.
Although the list may be small for now, this does mean with a little bit of Groovy scripting, you can create your own scripts to interpret REST commands and send them to the server!</p><p>All scripts for this purpose will be an implementation of class extending tigase.http.rest.Handler class. The URI of the scripts will be inside the scripts folder. For example, if the script uses TestHandler with a regular expression set to /test and is placed inside the scripts/rest/ the handler will be called with this URI: scripts/rest/test/.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_properties_2"></a>Properties</h5></div></div></div><p>When extending classes, you will need to set the following listed properties.
regex::
  Regular expression which is used to match request URI and parse parameters embedded in URI, for example:</p><pre class="literallayout">-----
/\/([^@\/]+)@([^@\/]+)/
-----</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">requiredRole</span></dt><dd>Role of user required to be able to access this URI. Available values are null, user, and admin. Authentication for the script will be required if requiredRole is not null.</dd><dt><span class="term">isAsync</span></dt><dd>If set to true, it will be possible to wait for results pending the arrival of IQ stanzas for instance.</dd></dl></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_properties_containing_closures_2"></a>Properties containing closures</h6></div></div></div><p>Extended class should also set for closures for one or more of the following properties: execGet, execPut, execPost, execDelete, depending on which HTTP action is needed to support the following URI. Each closure has a <span class="strong"><strong>dynamic arguments list</strong></span> generated at runtime. Below is a list of arguments passed to closure which describe how and when the list of arguments change.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">service</span></dt><dd>Implementation of service interface which is used to access database or send/receove XMPP stanzas.</dd><dt><span class="term">callback</span></dt><dd>Callback closures needs to be called to return data. However they only accept one argument of type string,byte[],Map. If data is Map tupe, it will be encoded to JSON or XML depending on Content-Type header.</dd><dt><span class="term">user</span></dt><dd>Is passed only if requiredRole is not null. Otherwise this argument will not be in the argument list.</dd><dt><span class="term">content</span></dt><dd>Parsed content of the request. <span class="strong"><strong>This will not be in the list of arguments if Content-Lengeth of request is empty.</strong></span> If Content-Type is set to XML or JSON the return result will be as Map, otherwise it will be an instance of HttpServletRequest.</dd><dt><span class="term">x</span></dt><dd>Additional arguments passed to callback are groups from regular expression matching the URI. Groups are not passed as a list, but are added to the list of arguments and next arguments.</dd></dl></div><p>If a property for corresponding HTTP action is not set, the component will return an HTTP 404 error.</p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_example_script"></a>Example Script</h5></div></div></div><p>Lets have a look at a script that is included with the install package to get a better idea of how these scripts work.
This script will GET a list of all registered account and output them according to an HTML file we will look at later.</p><pre class="programlisting">import tigase.http.rest.Service
import tigase.xmpp.BareJID

/**
 * Class implements ability to retrieve by service administrator list of registered accounts
 * Handles requests for /rest/users/
 *
 * Example format of content of response:
 * &lt;users&gt;&lt;items&gt;&lt;item&gt;user1@domain&lt;/item&gt;&lt;item&gt;user2@domain&lt;/item&gt;&lt;/items&gt;&lt;count&gt;2&lt;/count&gt;&lt;/users&gt;
 */
class UsersHandler extends tigase.http.rest.Handler {

    public UsersHandler() {
		description = [
			regex : "/",
			GET : [ info:'Retrieve list of registered user jids',
				description: """Request do not require any parameters and returns list of all registered user accounts on this server (for all vhosts).

Example response will look like this:
\${util.formatData([users:[items:['user1@example.com','user2@example.com','user1@example2.com'],count:3]])}
"""]
		];
        regex = /\//
        requiredRole = "admin"
        isAsync = false
        execGet = { Service service, callback, jid -&gt;
            def users = service.getUserRepository().getUsers()
            callback([users:[items:users, count:users.size()]]);
        }
    }

}</pre><p>As we can see, it&#8217;s a fairly short code.  First it calls the rest service (required for all of the REST activity), and the BareJID handler.
Next we extend out custom class to extend tigase.http.rest.Handler. Our author has provided a helpful description of the code to better describe it&#8217;s operation and expected result.
The last section is the actual code that defines what will match our query, in this case anything, a requirement that an admin make the command, that the connection will terminate with results, and what commands will be passed.</p><p>The matching HTML, which will shape the output of the code is included here.</p><pre class="programlisting">${ util.include('header', [title:'All users']) }
&lt;table style="margin: auto;"&gt;
&lt;tr&gt;
&lt;th&gt;Avatar&lt;/th&gt;
&lt;th&gt;User JID&lt;/th&gt;
&lt;/tr&gt;
&lt;% result.users.items.each { user -&gt; %&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;img style="max-height: 50px; max-width: 50px;" src="${util.link("/avatar/" + user)}" /&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;a href="${util.link("/user/"+user)}"&gt;${user}&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;% } %&gt;
&lt;/table&gt;
${ util.include('footer') }</pre><p>This file builds a table using the user fields from the GET request. <span class="strong"><strong>NOTE:</strong></span> Not all scripts need a matching HTML file, basic requests may not need special handling.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_rest_api_pubsub"></a>REST API &amp; PubSub</h4></div></div></div><p>All PubSub Scripts are found within the scripts/rest/pubsub directory of Tigase&#8217;s installation directory.  All examples in this section are prepared for a PubSub component available at <a class="link" href="mailto:pubsub@example.com" target="_top">pubsub@example.com</a>. To use these examples for your installation, that JID needs to be replaced with with your pubsub JID.</p><p>All parameters passed in the content of HTTP request needs to be wrapped with &lt;data/&gt; tag at the root of the XML document. Returned results will be wrapped within the &lt;result/&gt; tag in the root of the XMl document.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_create_a_node"></a>Create a Node</h5></div></div></div><p>HTTP URL: example.com/rest/pubsub/pubsub@example.com/create-node</p><p>Available HTTP methods:</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed to the newly created node.</p><p><span class="strong"><strong>POST</strong></span></p><p>Command requires fields node and pubsub#node_type to be filled with proper values for execution.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">node Field contains id of node to create</li><li class="listitem">owner Field may contain JID or JIDS which will be considered owner of the node. If this field is empty, server will use JID of HTTP API Component (<a class="link" href="mailto:rest@example.com" target="_top">rest@example.com</a>)</li><li class="listitem"><p class="simpara">pubsub#node_type Field should contain one of two types:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">leaf Node to items that will be published</li><li class="listitem">collection Node to nodes what will contain other nodes</li></ul></div></li></ul></div><p>Below is an example of creating a leaf type node with the owner set to <a class="link" href="mailto:admin@example.com" target="_top">admin@example.com</a>.</p><pre class="programlisting">&lt;data&gt;
  &lt;node&gt;example&lt;/node&gt;
  &lt;owner&gt;admin@example.com&lt;/owner&gt;
  &lt;pubsub prefix="true"&gt;
    &lt;node_type&gt;leaf&lt;/node_type&gt;
  &lt;/pubsub&gt;
&lt;/data&gt;</pre><p>Server response:</p><pre class="programlisting">&lt;result&gt;
  &lt;Note type="fixed"&gt;
    &lt;value&gt;Operation successful&lt;/value&gt;
  &lt;/Note&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_delete_a_node"></a>Delete a node</h5></div></div></div><p>HTTP URL: example.com/rest/pubsub/pubsub@example.com/delete-node</p><p>Available HTTP methods:</p><p><span class="strong"><strong>GET</strong></span></p><p>Command returns example content which contains all required and operational parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>Command requires field node to be filled where node is the id of the node to delete.</p><p>Below is an example of removing a node with an id of example</p><pre class="programlisting">&lt;data&gt;
  &lt;node&gt;example&lt;/node&gt;
&lt;/data&gt;</pre><p>Server response</p><pre class="programlisting">&lt;result&gt;
  &lt;Note type="fixed"&gt;
    &lt;value&gt;Operation successful&lt;/value&gt;
  &lt;/Note&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_subscribe_to_a_node"></a>Subscribe to a node</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub@example.com/subscribe-node</p><p>Available HTTP methods:</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>Command requires node and jid fields to be filled.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">node is the id of the node to subscribe too.</li><li class="listitem">jid is the JID or JIDS to be subscribed to the node.</li></ul></div><p>Below is an example of the XML information passed between client and server with test1@example.com and test2@example.com subscribing to example node.</p><pre class="programlisting">&lt;data&gt;
  &lt;node&gt;example&lt;/node&gt;
  &lt;jids&gt;
    &lt;value&gt;test1@example.com&lt;/value&gt;
    &lt;value&gt;test2@example.com&lt;/value&gt;
  &lt;/jids&gt;
&lt;/data&gt;</pre><p>Server response:</p><pre class="programlisting">&lt;result&gt;
  &lt;Note type="fixed"&gt;
    &lt;value&gt;Operation successful&lt;/value&gt;
  &lt;/Note&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_unsubscribe_from_a_node"></a>Unsubscribe from a node</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub@example.com/unsubscribe-node</p><p>Available HTTP methods:</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>Like the Subscribe to a node section, the command requires both the node and jid fields to be filled.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">node is the id of the node to unsubscribe from.</li><li class="listitem">jid is the JID or JIDS to be unsubscribed from the node.</li></ul></div><p>Below is an example of the XML information passed between client and server with test1@example.com and test2@example.com unsubscribing to example node.</p><pre class="programlisting">&lt;data&gt;
  &lt;node&gt;example&lt;/node&gt;
  &lt;jids&gt;
    &lt;value&gt;test@example.com&lt;/value&gt;
    &lt;value&gt;test2@example.com&lt;/value&gt;
  &lt;/jids&gt;
&lt;/data&gt;</pre><p>Server response:</p><pre class="programlisting">&lt;result&gt;
  &lt;Note type="fixed"&gt;
    &lt;value&gt;Operation successful&lt;/value&gt;
  &lt;/Note&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_publish_an_item_to_a_node"></a>Publish an item to a node</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub@example.com/publish-item</p><p>Available HTTP methods:</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>Command requires the node and entry fields to be filled.
Available fields:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">node Field contains the id of the node to be published to.</li><li class="listitem">item-id Field to contain the id of the entry to publish.</li><li class="listitem">expire-at Field may contain a timestamp after which item should not be delivered to subscribed users.  Timestamp should follow this pattern: YYYY-MM-DDhh:mm:ss with a trailing Z to indicate UTC time in a 24h format.</li><li class="listitem">entry Field should contain multi-line entry content which should be valid XML value for an item.</li></ul></div><p>Below is an example exchange between client and server for publishing an item with id item-1 to node example .</p><pre class="programlisting">&lt;data&gt;
  &lt;node&gt;example&lt;/node&gt;
  &lt;item-id&gt;item-1&lt;/item-id&gt;
  &lt;expire-at&gt;2015-05-13T16:05:00+02:00&lt;/expire-at&gt;
  &lt;entry&gt;
    &lt;item-entry&gt;
      &lt;title&gt;Example 1&lt;/title&gt;
      &lt;content&gt;Example content&lt;/content&gt;
    &lt;/item-entry&gt;
  &lt;/entry&gt;
&lt;/data&gt;</pre><p>Server response:</p><pre class="programlisting">&lt;result&gt;
  &lt;Note type="fixed"&gt;
    &lt;value&gt;Operation successful&lt;/value&gt;
  &lt;/Note&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_list_available_nodes"></a>List Available Nodes</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub.example.com/list-nodes</p><p>Available HTTP methods</p><p><span class="strong"><strong>GET</strong></span></p><p>This method returns list of available PubSub nodes for the domain passed as part of the URI (pubsub.example.com).</p><p>Below is an example exchange between client and server for listing all nodes, the result having test, node_54idf40037 and node_3ws5lz0037</p><pre class="programlisting">&lt;result&gt;
&lt;title&gt;List of available nodes&lt;/title&gt;
&lt;nodes label="Nodes" type="text-multi"&gt;
&lt;value&gt;test&lt;/value&gt;
&lt;value&gt;node_54idf40037&lt;/value&gt;
&lt;value&gt;node_3ws5lz0037&lt;/value&gt;
&lt;/nodes&gt;
&lt;/result&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_list_published_items_on_node"></a>List Published Items on Node</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub.example.com/list-items</p><p>Available HTTP methods</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>This command requires the node field to be filled.  The node field contains the ID of the node from which we want the list of published items.</p><p>Below is an example exchange between client and server asking for all items published in the example node.</p><pre class="programlisting">&lt;data&gt;
&lt;node&gt;example&lt;/node&gt;
&lt;/data&gt;</pre><p>Server Response</p><pre class="programlisting">&lt;result&gt;
&lt;title&gt;List of PubSub node items&lt;/title&gt;
&lt;node label="Node" type="text-single"&gt;
&lt;value&gt;example&lt;/value&gt;
&lt;/node&gt;
&lt;items label="Items" type="text-multi"&gt;
&lt;value&gt;item-1&lt;/value&gt;
&lt;value&gt;item-2&lt;/value&gt;
&lt;/items&gt;
&lt;/result&gt;</pre><p>Items item-1 and item-2 are the listed items.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_retrieve_published_item_on_node"></a>Retrieve Published Item on Node</h5></div></div></div><p>HTTP URI: example.com/rest/pubsub/pubsub.example.com/retrieve-item</p><p>Available HTTP methods</p><p><span class="strong"><strong>GET</strong></span></p><p>Method returns example content which contains all required and optional parameters that may be passed.</p><p><span class="strong"><strong>POST</strong></span></p><p>Command requires that fields node and item-id are filled.
Available Fields:
- node The node the item is published to.
- item-id The id of the item you wish to retrieve.</p><p>Example communication between client and server:</p><pre class="programlisting">&lt;data&gt;
&lt;node&gt;example&lt;/node&gt;
&lt;item-id&gt;item-1&lt;/item&gt;
&lt;/data&gt;</pre><p>Server response:</p><pre class="programlisting">&lt;result&gt;
&lt;title&gt;Retrive PubSub node item&lt;/title&gt;
&lt;node label="Node" type="text-single"&gt;
&lt;value&gt;example&lt;/value&gt;
&lt;/node&gt;
&lt;item-id label="Item ID" type="text-single"&gt;
&lt;value&gt;item-1&lt;/value&gt;
&lt;/item-id&gt;
&lt;item label="Item" type="text-multi"&gt;
&lt;value&gt;&amp;lt;item expire-at=&amp;quot;2015-05-13T14:05:00Z&amp;quot; id=&amp;quot;item-1&amp;quot;&amp;gt;&amp;lt;item-entry&amp;gt;
&amp;lt;title&amp;gt;Example 1&amp;lt;/title&amp;gt;
&amp;lt;content&amp;gt;Example content&amp;lt;/content&amp;gt;
&amp;lt;/item-entry&amp;gt;&amp;lt;/item&amp;gt;
&lt;/value&gt;
&lt;/item&gt;
&lt;/result&gt;</pre><p>Node that inside the item element, there is an XML encoded element, this will be retrieved without any decoding.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_other_example_rest_commands_and_documentation"></a>Other Example REST Commands and Documentation</h4></div></div></div><p>Other example REST commands, and accompanied documentation can be found at localhost:8080/rest/ on any server running Tigase and the HTTP component.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adminUI"></a>Admin UI Guide</h3></div></div></div><p>The Admin User Interface is an HTTP-based interface that sends REST commands to the server to update configurations, change settings, and retrieve statistics.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_a_note_about_rest"></a>A Note about REST</h4></div></div></div><p>REST stands for REpresentational State Transfer which is a stateless communication method that in our case passes commands using HTTP GET, PUT, POST, and DELETE commands to resources within the Tigase server.
Although REST uses HTTP to receive commands, REST itself is not intended for use in a browser.  For more information, please see the REST API guide.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_configuration_5"></a>Configuration</h4></div></div></div><p>Allows you to list server components and their configurations, as well as manage server components and plugins.</p><p>List server/component configuration section covers all the component options including the basic-conf and will allow you to change each setting by changing the values in the field and clicking submit.  All settings are listed by the component name in the dropdown menu either as default, or as defined by --component-name property.</p><p><span class="inlinemediaobject"><img src="./images/admin-componentconfig.jpg" alt="admin-componentconfig"></span></p><p>Manage active server components allows you to do exactly that, but you can also add and disable components from this interface.</p><p><span class="inlinemediaobject"><img src="./images/admin-managecomponent.jpg" alt="admin-managecomponent"></span></p><p>Here you can List, Add, Edit, and Remove components.
- <span class="strong"><strong>List</strong></span> provides a list of all running components, each with its name, info, and class.
- <span class="strong"><strong>Add</strong></span> provides an interface to add a class and a name for components. You will not be able to add invalid component names or classes.
- <span class="strong"><strong>Edit</strong></span> enables you to edit the specific properties of any running component. Even options for which there are no current values will be listed, you can consider this list a comprehensive list of settings and options for the current component.
- <span class="strong"><strong>Remove</strong></span> provides a way to remove running components.</p><p>Managing server plugins allows you to turn on or off plugins from this window VIA check-boxes. Note that the changes are made in real-time.</p><p><span class="inlinemediaobject"><img src="./images/admin-manageplugins.jpg" alt="admin-manageplugins"></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_example_scripts"></a>Example Scripts</h4></div></div></div><p>This is a list of script examples that can be run and do menial functions for each component.  They may not have particular value themselves, but are present to be used as reference when writing custom scripts.
Get list of available commands is one script, that is present for every component that is active on the server, and as its title implies, will provide a list of all commands for that component.  Lastly, the two scripts from the <a class="link" href="">Scripting section</a> of this guide.  Generally, there is not much needed to see in this section.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_notifications"></a>Notifications</h4></div></div></div><p>This section has one simple command: to be able to send a mass message to all logged in users.
There are three types of messages that can be sent from this section:
- <span class="strong"><strong>normal</strong></span> Messages will show as a pop-up in most clients.
- <span class="strong"><strong>headline</strong></span> Certain clients will take headline messages and insert them into MUC or chats between users, otherwise it will create a pop-up like normal messages.
- <span class="strong"><strong>chat</strong></span> Chat messages will open up a chat dialog with users.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_other"></a>Other</h4></div></div></div><p>This section contains a considerable list of options and settings affecting server functions.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_activate_log_tracker_for_a_user"></a>Activate log tracker for a user</h5></div></div></div><p>This allows you to set a log file to track a specific user.  Set the bare or full JID of the user you want to log, and a name of the files you wish the log to be written to. The files will be written in the root Tigase directory unless you give a directory like logs/filename. The log files will be named with a .0 extension and will be named .1, .2, .3 and so on as each file reaches 10MB by default. filename.0 will always be the most recent.
Logging will start once the command has been issued, and cease once the server restarts.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_ssl_certificate"></a>Add SSL certificate</h5></div></div></div><p>Here you can add SSL certificates from PEM files to specific virtual hosts. Although Tigase can generate its own self-signed certificates, this will override any default certificates.
The certificates cannot contain a passphrase, or be encrypted.  Be sure that the contents contain both the certificate and private key data.
You also have the option to save the certificate to disk, making the change permanent.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_listener_script"></a>Add listener script</h5></div></div></div><p>This section allows you to create a custom function for the eventbus component.  These scripts can have the server conduct certain operations if set criteria are met. You may write the script in either Groovy or EMCAscript. Please see the <a class="link" href="">eventbus section</a> for more details.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_monitor_task"></a>Add Monitor Task</h5></div></div></div><p>You can write scripts for Groovy or ECMAScript to add to monitor tasks here. This only adds the script to available scripts however, you will need to run it from another prompt.
Note that these scripts may only work with the monitor component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_monitor_timer_task"></a>Add Monitor Timer Task</h5></div></div></div><p>This section allows you to add monitor scripts in Groovy while using a delay setting which will delay the start of the script.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_new_item_ext"></a>Add New Item - ext</h5></div></div></div><p>Depending on whether you have any external components loaded or not, this may show.  This allows you to add additional external components to the running instance of Tigase.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_new_item_vhost"></a>Add New Item - Vhost</h5></div></div></div><p>This allows you to add new virtual hosts to the XMPP server.  A breakdown of the fields is as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Domain name: the full domain name of the new vhost.  Tigase will not add anything to this domain, so if it is ti be a subdomain of example.com, you will need to enter sub.domain.com.</li><li class="listitem">Enabled: Whether the domain is turned on or off.</li><li class="listitem">Anonymous enabled: Allow anonymous logins.</li><li class="listitem">In-band registration: Whether or not to allow users to register accounts upon login.</li><li class="listitem">TLS required: Require logins to the vhost to conduct a TLS handshake before opening streams.</li><li class="listitem">S2S secret: a server-generated code to differentiate traffic between servers, typically there is no need to enter your own, but you may if you need to get into low level code.</li><li class="listitem">Domain filter policy: Sets the filter policy for this domain, see <a class="link" href="tigase41packetFiltering.html#domainBasedPacketFiltering" title="Domain Based Packet Filtering">This section</a> for a description of the rules.</li><li class="listitem">Domain filter domains: a specific setting to restrict or control cross domain traffic.</li><li class="listitem">Max users: maximum users allowed to be registered to the server.</li><li class="listitem">Allowed C2S, BOSH, Websocket ports: Comma separated list of ports that this vhost will check for all of these services.</li><li class="listitem">Presence forward address: specific address where presence information is forwarded too.  This may be handy if you are looking to use a single domain for presence processing and handling.</li><li class="listitem">Message forward address: Specific address where all messages will be sent too.  This may be useful to you if you have a single server handling AMP or message storage and want to keep the load there.</li><li class="listitem">Other Parameters: Other settings you may wish to pass to the server, consider this a section for options after a command.</li><li class="listitem">Owner: The owner of the vhost who will also be considered an administrator.</li><li class="listitem">Administrators: comma separated list of JIDs who will be considered admins for the vhost.</li><li class="listitem">XEP-0136 Message Archiving Enabled: Whether to turn on or off this feature.</li><li class="listitem">XEP-0136 Required store method: If XEP-0136 is turned on, you may restrict the portion of message that is saved. This is required for any archiving, if null, any portion of the message may be stored.</li><li class="listitem">Client certificate required: Whether the client should submit a certificate to login.</li><li class="listitem">Client certificate CA: The Certificate Authority of the client certificate.</li><li class="listitem">XEP-0136 retention period: integer of number of days message archives will be set.</li><li class="listitem">Trusted JIDs: Comma separated list of JIDs who will be added to the trusted list, these are JIDS that may conduct commands, edit settings, or other secure work without needed secure logins.</li><li class="listitem">XEP-0136 retention type: Sets the type of data that retention period will use.  May be User defined (custom number type), Unlimited, or Number of Days.</li><li class="listitem">XEP-0136 - store MUC messages: Whether or not to store MUC messages for archiving.  Default is user, which allows users to individually set this setting, otherwise tue/false will override.</li><li class="listitem">see-other-host redirection enabled: in servers that have multiple clusters, this feature will help to automatically repopulate the cluster list if one goes down, however if this is unchecked, that list will not change and may attempt to send traffic to a down server.</li><li class="listitem">XEP-0136 Default store method: The default section of messages that will be stored in the archive.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_change_user_inter_domain_communication_permission"></a>Change user inter-domain communication permission</h5></div></div></div><p>Here you can restrict users to be able to communicate on specific domains, this works similar to the domain filtering policy using the same rule sets. For more details, see <a class="link" href="tigase41packetFiltering.html#domainBasedPacketFiltering" title="Domain Based Packet Filtering">Domain Based Packet Filtering</a> section for rule details and specifics.
Note that the changes may be made to mutiple JIDs at the same time.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_connections_time"></a>Connections Time</h5></div></div></div><p>Lists the longest and average connection time from clients to servers.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_create_node"></a>Create Node</h5></div></div></div><p>This section allows you to create a new node for the pubsub component.  Here is a breakdown of the fields:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The node to create: this is the name of the node that will be created.</li><li class="listitem">Owner JID: user JID who will be considered the owner of the node.</li><li class="listitem"><p class="simpara">pubsub#node type: sets the type of node the the new node will be.  Options include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>leaf</strong></span> Node that can publish and be published too.</li><li class="listitem"><span class="strong"><strong>collection</strong></span> A collection of other nodes.</li></ul></div></li><li class="listitem">A friendly name for the node: Allows spaces and other characters to help differentiate it from other nodes.</li><li class="listitem">Whether to deliver payloads with event notifications: as it says, to publish events or not.</li><li class="listitem">Notify subscribers when the configuration changes: default is false</li><li class="listitem">Persist items to storage: whether or not to physically store items in the node.</li><li class="listitem">Max # of items to persist: Limit how many items are kept in the node archive.</li><li class="listitem">The collection with which the node is affiliated: If the node is to be in a collection, place that node name here.</li><li class="listitem"><p class="simpara">Specify the subscriber model: Choose what type of subscriber model will be used for this node.  Options include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>authorize</strong></span> - Requires all subscriptions to be approved by the node owner before items will be published to the user.  Also only subscribers may retrieve items.</li><li class="listitem"><span class="strong"><strong>open</strong></span> - All users may subscribe and retrieve items from the node.</li><li class="listitem"><span class="strong"><strong>presence</strong></span> - Typically used in an instant message environment. Provides a system under which users who are subscribed to the owner JID&#8217;s presence with a from or both subscription may subscribe from and retrieve items from the node.</li><li class="listitem"><span class="strong"><strong>roster</strong></span> - This is also used in an instant message environments, Users who are both subscribed to the owners presence AND is placed in specific allowed groups by the roster are able to subscribe to the node and retrieve items from it.</li><li class="listitem"><span class="strong"><strong>whitelist</strong></span> - Only explicitly allowed JIDs are allowed to subscribe and retrieve items from the node, this list is set by the owner/administrator.</li></ul></div></li><li class="listitem"><p class="simpara">Specify the Publisher model: Choose what type of publisher model will be used for this node.  Options include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>open</strong></span> - Any user may publish to this node.</li><li class="listitem"><span class="strong"><strong>publishers</strong></span> - Only users listed as publishers may be able to publish.</li><li class="listitem"><span class="strong"><strong>subscribers</strong></span> - Only subscribers may publish to this node.</li></ul></div></li><li class="listitem"><p class="simpara">When to send the last published item: This allows you to decide if and when the last published item to the node may be sent to newly subscribed users.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>never</strong></span> - Do not send the last published item.</li><li class="listitem"><span class="strong"><strong>on_sub</strong></span> - Send the last published item when a user subscribes to the node.</li><li class="listitem"><span class="strong"><strong>on_sub_and_presence</strong></span> - Send the last published item to the user after a subscription is made, and the user is available.</li></ul></div></li><li class="listitem">The domains allowed to access this node: Comma separated list of domains for which users can access this node.  By default is is blank, and there is no domain restriction.</li><li class="listitem">Whether to deliver items to available users only: Items will only be published to users with available status if this is selected.</li><li class="listitem">Whether to subscription expired when subscriber going offline: This will make all subscriptions to the node valid for a single session and will need to be re-subscribed upon reconnect.</li><li class="listitem">The XSL transformation which can be applied to payloads in order to generate an appropriate message body element: Since you want a properly formatted &lt;body&gt; element, you can add an XSL transformation here to address any payloads or extra elements to be properly formatted here.</li><li class="listitem">The URL of the XSL transformation which can be applied to payloads in order to generate an appropriate message body element: This would be the URL of the XSL Transform, e.g. <a class="link" href="http://www.w3.org/1999/XSL/Transform" target="_top">http://www.w3.org/1999/XSL/Transform</a>.</li><li class="listitem">Roster groups allowed to subscribe: a list of groups for whom users will be able to subscribe.  If this is blank, no user restriction will be imposed.</li><li class="listitem">Notify subscribers when owner changes their subscription or affiliation state: This will have the node send a message in the case of an owner changing affiliation or subscription state.</li><li class="listitem">Allows get list of subscribers for each subscriber: Allows subscribers to produce a list of other subscribers to the node.</li><li class="listitem"><p class="simpara">Whether to sort collection items by creation date or update time: options include</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>byCreationDate</strong></span> - Items will be sorted by the creation date, i.e. when the item was made.</li><li class="listitem"><span class="strong"><strong>byUpdateTime</strong></span> - Items will be sorted by the last update time, i.e. when the item was last edited/published/etc..</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_dns_query"></a>DNS Query</h5></div></div></div><p>A basic DNS Query form.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_default_config_pubsub"></a>Default config - Pubsub</h5></div></div></div><p>Here you may set the default configuration for any new pubsub node.  These changes will be made for all future nodes, but will not affect currently active nodes.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_default_room_config"></a>Default room config</h5></div></div></div><p>This page allows admins to set the default configuration for any new MUC rooms that may be made on the server.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_delete_monitor_task"></a>Delete Monitor Task</h5></div></div></div><p>This removes a monitor task from the list of available monitor scripts. This action is not permanent as it will revert to inital settings on server restart.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_delete_node"></a>Delete Node</h5></div></div></div><p>Provides a space to remove a node from the server.  It must be the full name of the node, and only one node can be removed at a time.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_deleting_all_nodes"></a>Deleting ALL Nodes</h5></div></div></div><p>This page allows the logged in admin to delete all nodes from the associated vhost.  This change is irreversible, be sure to read and check the box before submitting the command.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_fix_user_s_roster"></a>Fix User&#8217;s Roster</h5></div></div></div><p>You can fix a users roster from this prompt. Fill out the bare JID of the user and the names you wish to add or remove from the roster. This will NOT edit a user&#8217;s roster, but rather compare client roster to database and fix any errors between them.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_fix_user_s_roster_on_tigase_cluster"></a>Fix User&#8217;s Roster on Tigase Cluster</h5></div></div></div><p>This does the same as the Fix User&#8217;s Roster, but can apply to users who may not be logged into the local vhost, but are logged into a clustered server.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_user_roster"></a>Get User Roster</h5></div></div></div><p>As the title implies this gets a users' roster and displays it on screen. You can use a bare or full JID to get specific rosters.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_any_file"></a>Get any file</h5></div></div></div><p>Enables you to see the contents of any file in the tigase directory. By default you are in the root directory, if you wish to go into directory use the following format:
logs/tigase.log.0</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_configuration_file"></a>Get Configuration File</h5></div></div></div><p>If you don&#8217;t want to type in the location of a configuration file, you can use this prompt to bring up the contents of either tigase.conf or init.properties.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_init_properties_file"></a>Get init.properties File</h5></div></div></div><p>Will output the current init.properties file, this includes any modifications made during the current server session.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_list_available_commands"></a>Get list available commands</h5></div></div></div><p>This may be listed multiple times for different components, but this will do as the section suggest and list available commands for that particular component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_load_test"></a>Load test</h5></div></div></div><p>Here you can run a test with the pubsub component on any node to test functionality and proper settings for the node.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_load_errors"></a>Load Errors</h5></div></div></div><p>Will display any errors the server encounters in loading and running. Can be useful if you need to address any issues.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_new_command_script"></a>New command script</h5></div></div></div><p>This space allows you to create a new command script that will work within the associated component.  Note that under the hyperlinked title, there is a listing of muc.server.org or pubsub.server.org, use these to determine where the new command will operate.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_oauth_credentials"></a>OAuth Credentials</h5></div></div></div><p>This allows the setting of new custom OAuth credentials for the server, and you can also require the use of OAuth tokens for users when they login.  This is a setting for the specific host you are logged into.  If you are logged into xmpp1.domain.com, it will not affect settings for xmpp2.domain.com.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_pre_bind_bosh_user_session"></a>Pre-Bind BOSH user session</h5></div></div></div><p>This allows a JID to be paired with a BOSH session before that user logs in, can reduce CPU use if you have a user that logs in via BOSH on a regular basis, or a web client that will regularly connect. You may also specify HOLD and WAIT integers to affect how BOSH operates with the associated JID.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_publish_item_to_node"></a>Publish item to node</h5></div></div></div><p>This window allows you to not only test, but publish an item to the specified node.  All fields must be filled in in order to avoid the server dropping an improperly formatted stanza.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_read_all_nodes"></a>Read ALL nodes</h5></div></div></div><p>Here you can display all nodes and items from nodes that are currently in storage.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_rebuild_database"></a>Rebuild database</h5></div></div></div><p>This will force Tigase to rebuild databases for the pubsub component, this may be useful for pubsub subscribers who continue to get pushed events after they unsubscribe.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_reload_component_repository"></a>Reload component repository</h5></div></div></div><p>This will reload any vhosts that the server is running.  This may be useful if one is disconnected or broken during runtime.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remove_an_item"></a>Remove an item</h5></div></div></div><p>This will remove a running vhost from the server, you will be presented with a list to pick from.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remove_command_script"></a>Remove command script</h5></div></div></div><p>Like new command script, take a look at the subheading to determine which component you want to remove the script from.  Once there, select the command you wish to remove from the server.  If remove from disk is selected, then the change will be permanent.  Otherwise, the command will be removed until the next server restart.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remove_listener_script"></a>Remove listener script</h5></div></div></div><p>Select from a list the listener script you wish to remove.  This will only affect custom listener scripts added to the eventbus component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remove_room"></a>Remove room</h5></div></div></div><p>This provides fields to remove a room from the MUC component. you may suggest an alternative room which will move occupants to the alternative room once the current one is removed.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_retrieve_items"></a>Retrieve items</h5></div></div></div><p>Here you can retrieve items from PubSub nodes, this simulates the get IQ stanza from the pubsub component.
- Service name - The address of the pubsub component.
- Node name - Item node to retrieve items from.
- Item ID - The item ID of the item you wish to retrieve.
- Items Since - UTC timestamp to start search from: YYYY-MM-DDTHH:MM:SSZ</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_s2s_bad_state_connections"></a>S2S Bad State Connections</h5></div></div></div><p>This will list any connections to other servers that are considered bad or stale.  This will populate very rarely as Tigase automatically adjusts around clustered servers that go down.  In the event a connection stays bad, it is recommended to reset those connections in the next space.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_s2s_reset_bad_state_connections"></a>S2S Reset Bad State Connections</h5></div></div></div><p>This will reset the connections with other servers that are considered bad and have shown up in the S2S Bad State Connections page.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_s2s_get_cid_connection_state"></a>S2S Get CID Connection State</h5></div></div></div><p>For internal developer use only.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_subscribe_to_a_node_2"></a>Subscribe to a node</h5></div></div></div><p>This provides a space for an administrator to manually have a JID subscribe to a particular node.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_unsubscribe_from_node"></a>Unsubscribe from node</h5></div></div></div><p>Here you can unsubscribe users from a particular node.  Users can be a comma separated list.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_update_item_configuration"></a>Update item configuration</h5></div></div></div><p>Typically two entries will be seen for this entry, one for basic-conf and another for vhost-man. They each have their own sections, but provide for a plethora of server options.  Changes to the server are done in realtime, and may not be permanent.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_basic_conf"></a>basic-conf</h6></div></div></div><p>This will prompt a list of nearly every component setting currently available in the Tigase installation.  They are broken down as follows:
Component/catagory or setting/setting
So for example, if you wanted to change admins for the eventbus component, you will select 'eventbus/admins'.
Another example might be if you wanted to turn on or off a task in monitor component, lets say disk-checker-task, you would find 'monitor/disk-checker-task/enabled'.
Clicking Submit query will show current status and settings, and possible fields to change.  Most changes done in this manner will be reset to default or as written in init.properties file on server restart.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_vhost_man"></a>vhost-man</h6></div></div></div><p>You will be presented with a list of domains that Tigase is currently hosting, you will be able to change settings for one domain at a time using this function.  Once a domain is selected, you will be able to set or change the following settings:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Domain name: the full domain name of the new vhost.  Tigase will not add anything to this domain, so if it is ti be a subdomain of example.com, you will need to enter sub.domain.com.</li><li class="listitem">Enabled: Whether the domain is turned on or off.</li><li class="listitem">Anonymous enabled: Allow anonymous logins.</li><li class="listitem">In-band registration: Whether or not to allow users to register accounts upon login.</li><li class="listitem">TLS required: Require logins to the vhost to conduct a TLS handshake before opening streams.</li><li class="listitem">S2S secret: a server-generated code to differentiate traffic between servers, typically there is no need to enter your own, but you may if you need to get into low level code.</li><li class="listitem">Domain filter policy: Sets the filter policy for this domain, see <a class="link" href="tigase41packetFiltering.html#domainBasedPacketFiltering" title="Domain Based Packet Filtering">This section</a> for a description of the rules.</li><li class="listitem">Domain filter domains: a specific setting to restrict or control cross domain traffic.</li><li class="listitem">Max users: maximum users allowed to be registered to the server.</li><li class="listitem">Allowed C2S, BOSH, Websocket ports: Comma separated list of ports that this vhost will check for all of these services.</li><li class="listitem">Presence forward address: specific address where presence information is forwarded too.  This may be handy if you are looking to use a single domain for presence processing and handling.</li><li class="listitem">Message forward address: Specific address where all messages will be sent too.  This may be useful to you if you have a single server handling AMP or message storage and want to keep the load there.</li><li class="listitem">Other Parameters: Other settings you may wish to pass to the server, consider this a section for options after a command.</li><li class="listitem">Owner: The owner of the vhost who will also be considered an administrator.</li><li class="listitem">Administrators: comma separated list of JIDs who will be considered admins for the vhost.</li><li class="listitem">XEP-0136 Message Archiving Enabled: Whether to turn on or off this feature.</li><li class="listitem">XEP-0136 Required store method: If XEP-0136 is turned on, you may restrict the portion of message that is saved. This is required for any archiving, if null, any portion of the message may be stored.</li><li class="listitem">Client certificate required: Whether the client should submit a certificate to login.</li><li class="listitem">Client certificate CA: Client Certificate Authority.</li><li class="listitem">XEP-0136 retention period: Integer of number of days message archives will be set.</li><li class="listitem">Trusted JIDs: Comma separated list of JIDs who will be added to the trusted list, these are JIDS that may conduct commands, edit settings, or other secure work without needed secure logins.</li><li class="listitem">XEP-0136 retention type: Sets the type of data that retention period will use.  May be User defined (custom number type), Unlimited, or Number of Days.</li><li class="listitem">XEP-0136 - store MUC messages: Whether or not to store MUC messages for archiving.  Default is user, which allows users to individually set this setting, otherwise true/false will override.</li><li class="listitem">see-other-host redirection enabled: in servers that have multiple clusters, this feature will help to automatically repopulate the cluster list if one goes down, however if this is unchecked, that list will not change and may attempt to send traffic to a down server.</li><li class="listitem">XEP-0136 Default store method: The default section of messages that will be stored in the archive.</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_update_user_roster_entry"></a>Update user roster entry</h5></div></div></div><p>This section allows admins to edit individual users rosters, although it provides similar functionality to fix users roster, this is designed for precision editing of a user roster.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Roster owner JID: The BareJID of the user roster you wish to edit.</li><li class="listitem">JID to manipulate: The specific BareJID you want to add/remove/change.</li><li class="listitem">Comma separated groups: Groups you wish to add the JID too.</li><li class="listitem"><p class="simpara">Operation Type: What function will be performed?</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>Add</strong></span> - Add the JID to manipulate to the owner JID&#8217;s roster and groups.</li><li class="listitem"><span class="strong"><strong>Remove</strong></span> - Remove the JID to manipulate from the owner JID&#8217;s roster and groups.</li></ul></div></li><li class="listitem"><p class="simpara">Subscription type: The type of subscription stanza that will be sent to the server, and subsequently between the two users will be employed.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>None</strong></span> - Select this if neither the owner or the user to be manipulated wishes to receive presence information.</li><li class="listitem"><span class="strong"><strong>From</strong></span> - The Roster Owner will not receive presence information from the JID to manipulate, but the opposite will be true.</li><li class="listitem"><span class="strong"><strong>To</strong></span> - The JID to manipulate will not receive presence information from the Roster Owner, but the opposite will be true.</li><li class="listitem"><span class="strong"><strong>Both</strong></span> - Both JIDs will receive presence information about each other.</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_update_user_roster_entry_extended_version"></a>Update user roster entry extended version</h5></div></div></div><p>This section is an expanded version of the previous one, all fields already specified are the same with these additions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Roster owner name: A friendly name or nickname if you wish to change/create one. <span class="strong"><strong>not required</strong></span></li><li class="listitem">Comma separated of owner groups: Groups that the user wants to join/leave. <span class="strong"><strong>not required</strong></span></li><li class="listitem">Roster item JID: The specific JID that needs to be edited.</li><li class="listitem">Roster item name: A friendly name or nickname that will be changed/created. <span class="strong"><strong>not required</strong></span></li><li class="listitem">Comma separated list of item groups: A group or list of groups that the roster item JID will be added to/removed from.</li><li class="listitem"><p class="simpara">Action:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><span class="strong"><strong>Add/update item</strong></span> - Will add or update the item JID in the roster owner&#8217;s roster.</li><li class="listitem"><span class="strong"><strong>Remove item</strong></span> - Will remove the item JID from the roster owner&#8217;s roster.</li><li class="listitem"><span class="strong"><strong>Add/update both rosters</strong></span> - Will add or update the item in both roster owner and roster item&#8217;s roster.</li><li class="listitem"><span class="strong"><strong>Remove from both rosters</strong></span> - Will remove the item from both roster owner and roster item&#8217;s roster.</li></ul></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_scripts"></a>Scripts</h4></div></div></div><p>This section will enable administrators to custom write or enter their own scripts for specific components.  Each active component will have an entry for new and remove command scripts and scripts written there will be for that component.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_new_command_script_2"></a>New Command Script</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Description: A friendly name of the script, will be the title of the link in the menu on the left.</li><li class="listitem">Command ID: Internal command that Tigase will use when referencing this script.</li><li class="listitem">Group: The group for the script, which may be any of the headings on the left (Configuration, Example scripts, Notifications, Other etc..) or your own.  If no group exists, a new one will be created.</li><li class="listitem">Language: The language the script is written in.  Currently Tigase supports Groovy and EMCAScript.</li><li class="listitem">Script text: the fulltext of the script.</li><li class="listitem">Save to disk: Scripts that are saved to disk will be permanently stored in the server&#8217;s directory /scripts/admin/[Component]/commandID.js <span class="strong"><strong>NOTE</strong></span> Scripts that are NOT saved to disk will not survive a server restart.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remove_command_script_2"></a>Remove Command Script</h5></div></div></div><p>As with New Command Script, there is an entry for each component.  This page will provide a space to remove commands for the selected component.
You will be provided a list of scripts associated with that component.  You also have the open to remove from disk, which will permanently delete the script from the hard drive the server is on.  If this is unchecked, the script will be unavailable until the next restart.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_statistics_2"></a>Statistics</h4></div></div></div><p>This section is more useful to test statistics scripts and components, as many of them produce very small amounts of information, however these may be collected by other components or scripts for a better information display.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_user_statistics"></a>Get User Statistics</h5></div></div></div><p>Provides a script output of user statistics including how many active sessions are in use, number of packets used, specific connections and their packet usage and location. All resources will return individual stats along with IP addresses.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_active_user_list"></a>Get Active User List</h5></div></div></div><p>Provides a list of active users under the selected domain within the server.  An active user is considered a user currently logged into the XMPP server.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_list_of_idle_users"></a>Get list of idle users</h5></div></div></div><p>Provides a list of users who are idle on the server.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_list_of_online_users"></a>Get list of online users</h5></div></div></div><p>Provides a list of users who are currently online.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_number_of_active_users"></a>Get number of active users</h5></div></div></div><p>Provides a list of active users, users who are not idle or away.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_number_of_idle_users"></a>Get number of idle users</h5></div></div></div><p>Provides a number of idle users.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_top_active_users"></a>Get top active users</h5></div></div></div><p>Will produce a list of user-limited users who are considered most active in packets sent.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_users"></a>Users</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_user"></a>Add User</h5></div></div></div><p>Here you can add new users to any domain handled by vHosts, users are added to database immediately and are able to login.  <span class="strong"><strong>NOTE: You cannot bestow admin status to these users in this section.</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_change_user_password"></a>Change User Password</h5></div></div></div><p>This enables you to change the password of any user in the database. Although changes will take effect immediately, users currently logged in will not know the password has been changed until they try to log in again.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_delete_user"></a>Delete User</h5></div></div></div><p>This removes the user or users (comma separated) from the database. The deleted users will be kicked from the server once submit is clicked.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_end_user_session"></a>End user session</h5></div></div></div><p>Disconnects the current selected user by ending their session with the server.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_user_info"></a>Get User Info</h5></div></div></div><p>This section allows admins to get information about a specific user including current connections as well as offline and online messages awaiting delivery.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_registered_user_list"></a>Get registered user list</h5></div></div></div><p>This will display all registered users for the selected domain up to the number specified.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_modify_user"></a>Modify User</h5></div></div></div><p>Allows you to modify some user details including E-mail and whether it is an active user.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="webClient"></a>Tigase Web Client</h3></div></div></div><p>Tigase now has a fully featured XMPP client built right into the HTTP interface. Everything you would expect from an XMPP client can now be done from the comfort of your browser window with no software install required!</p><p>Lets walk through setup.</p><p>Tigase web client requires the Http.Message.Receiver plugin to be active.  To enable this add the following lines to your init.properties file:</p><pre class="screen">--comp-name-5:http
--comp-class-5:tigase.HttpMessageReceiver</pre><p><span class="strong"><strong>NOTE: If you selected HTTP API to be enabled on setup, you already have everything you need.</strong></span>
This sets up an HTTP server with the default port of 8080.  See the HTTP API guide for component configuration.</p><p>To access the client, point a browser to the following address:
xmpp.your-server.net:8080/ui/</p><p>It will ask you for a login, any bare JID of users registered with the server will work.
<span class="strong"><strong>NOTE: Use your bare JID for login</strong></span></p><p>Once you have logged in successfully, you will be presented with the following screen.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Home.jpg" alt="WebUI-Home"></span></p><p>The commands are broken into categories shown here.  All changes made in these sections are instant and should be seen the same as if you were using an external XMPP client like Psi.</p><p><span class="strong"><strong>NOTE</strong></span> The BOSH client will automatically translate all requests to the server name.  In some rare cases this may not be resolvable by the browser and you will be unable to login.  Should that happen, you may disable that feature using the following line in your init.properties:</p><p>bosh/send-node-hostname[B]=false</p><p>You may have to specifically designate the bosh URL when using the advanced tag in the login screen.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_chat_2"></a>Chat</h4></div></div></div><p>This is the default window, and your main interface for chatting inside XMPP with this server. <span class="strong"><strong>NOTE: you can only communicate to users logged onto the current server, or connected clusters</strong></span>
Users from your roster will be on the left panel, the right all active discussions and MUCs, as well as the currently selected chat will be available.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat.jpg" alt="WebUI-Chat"></span></p><p>Users that are logged in and on your roster will be displayed on the left side. Double-clicking will bring up a new chat window with the user. You can Right-click on them to bring up a sub menu with the following;</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Usersubmenu.jpg" alt="WebUI-Usersubmenu"></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Chat</strong></span> replicates a double-click and opens a new window for chat.</li><li class="listitem"><span class="strong"><strong>Modify</strong></span> brings up a dialogue that allows you to change the JID of the contact, a nickname, and group.</li><li class="listitem"><span class="strong"><strong>Delete</strong></span> removes the user from your roster. This will also remove subscription authorization for the selected user to receive presence information effectively removing you from their roster. <span class="strong"><strong>NOTE: this will not block user packets from your JID</strong></span></li><li class="listitem"><span class="strong"><strong>Info</strong></span> brings up the User Info (this is the disco#info command for the selected user)</li></ul></div><p>The top right section has a few icons with specific functionality, they are;</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat-Add-New.jpg" alt="WebUI-Chat-Add-New"></span> adds a new user to your roster.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat-NewMUC.jpg" alt="WebUI-Chat-NewMUC"></span> creates a new Multi-user chatroom.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat-Profile.jpg" alt="WebUI-Chat-Profile"></span> allows you to edit your user information such as picture and nickname.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat-CloseWindow.jpg" alt="WebUI-Chat-CloseWindow"></span> closes the active chat window.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Chat-settings.jpg" alt="WebUI-Chat-settings"></span> provides a place to change your password or publish changes to your user info. <span class="strong"><strong>NOTE: you are limited to changing the General fields</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_discovery_2"></a>Discovery</h4></div></div></div><p>This is your service discovery panel, which breaks down by component in the sidebar. Each component name and its associated JID is listed to help you find what you need. Most components give you an option to Execute commands with a few exceptions allowing browsing and the ability to join a MUC.</p><p><span class="strong"><strong>Browse</strong></span> allows you to dig deeper into certain components; for example list the chatrooms available in the MUC component. At the top of the page the specific JID of the component are you in will be displayed. This is a text field, and can be edited to reflect the JID of the component (or just the server name) to navigate.</p><p><span class="inlinemediaobject"><img src="./images/WebUI-Browse-Comp.jpg" alt="WebUI-Browse-Comp"></span></p><p><span class="strong"><strong>Join to Room</strong></span> will join you to a MUC room that is selected. Alternatively, selecting Join to Room while MUC component is selected, you can join and start a new MUC room.</p><p><span class="strong"><strong>Execute Command</strong></span> Provides a hierarchy of commands and options to view and edit settings, run commands and scripts, view contents of files, and see statistics. Since each Component can have a unique structure it is best to explore each to see what options are available.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_management_2"></a>Management</h4></div></div></div><p>This is an advanced window for settings and management for the XMPP server.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_configuration_6"></a>Configuration</h5></div></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_list_server_component_configuration"></a>List server/component configuration</h6></div></div></div><p>From a drop-down menu you can view all the active components, or the server configuration (basic-conf). This is a read-only list of the current settings.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_manage_active_server_components"></a>Manage active server components</h6></div></div></div><p>This section gives you a drop-down menu for components
- <span class="strong"><strong>List</strong></span> will provide a list of active running components with the following format
    component name :: componentInfo{Title=Server, Server version/revision (submission date), Class=component class} For example:
    amp :: componentInfo{Title=Tigase XMPP Server, Version=7.1.0-SNAPSHOT-b3990/574c329f (2015-08-28/10:32:06), Class=tigase.server.amp.AmpComponent}</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Add</strong></span> Allows you to activate a component in a similar way you would in the init.properties files. define a name for the component, and the class for the component. Once you click Confirm that component will be active and running.</li><li class="listitem"><span class="strong"><strong>Edit</strong></span> will allow you to edit details of the selected component. All possible values for the component will be listed, even ones that do not have specific settings. Changes will be immediate, although changes will revert to ones specified in init.properties upon restart.</li><li class="listitem"><span class="strong"><strong>Remove</strong></span> allows you to remove components from a dropdown list. Components will be removed upon confirmation, however settings will be reverted on server restart.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_manage_active_server_plugins"></a>Manage active server plugins</h6></div></div></div><p>Here is a list of all available plugins, and you can activate or deactivate them by checking or un-checking each one and clicking confirm. All changes are made in realtime, however changes will be reverted on server restart.</p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_notifications_2"></a>Notifications</h5></div></div></div><p>This section has one simple command: to be able to send a mass message to all logged in users.  You may choose to change the type of message to headline or Normal which will show as a pop-up in most XMPP clients.  Chat messages will open up a chat dialog with users.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_other_2"></a>Other</h5></div></div></div><p>This section contains a considerable list of options and settings affecting server functions.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_activate_log_tracker_for_a_user_2"></a>Activate log tracker for a user</h5></div></div></div><p>This allows you to set a log file to track a specific user.  Set the bare or full JID of the user you want to log, and a name of the files you wish the log to be written to. The files will be written in the root Tigase directory unless you give a directory like logs/filename. The log files will be named with a .0 extension and will be named .1, .2, .3 and so on as each file reaches 10MB by default. filename.0 will always be the most recent.
Logging will cease once the server restarts.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_ssl_certificate_2"></a>Add SSL certificate</h5></div></div></div><p>Here you can add SSL certificates from PEM files to specific virtual hosts. Although Tigase can generate its own self-signed certificates, this will override those default certificates.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_monitor_task_2"></a>Add Monitor Task</h5></div></div></div><p>You can write scripts for Groovy or ECMAScript to add to monitor tasks here. This only adds the script to available scripts however, you will need to run it from another prompt.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_monitor_timer_task_2"></a>Add Monitor Timer Task</h5></div></div></div><p>This section allows you to add monitor scripts in Groovy while using a delay setting which will delay the start of the script.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_new_item_ext_2"></a>Add New Item - ext</h5></div></div></div><p>Provides a method to add external components to the server. By default you are considered the owner, and the Tigase load balancer is automatically filled in.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_add_new_item_vhost_2"></a>Add New Item - Vhost</h5></div></div></div><p>This allows you to add new virtual hosts to the XMPP server</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_change_user_inter_domain_communication_permission_2"></a>Change user inter-domain communication permission</h5></div></div></div><p>You can restrict users to only be able to send and receive packets to and from certain virtual hosts. This may be helpful if you want to lock users to a specific domain, or prevent them from getting information from a statistics component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_connections_time_2"></a>Connections Time</h5></div></div></div><p>Lists the longest and average connection time from clients to servers.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_dns_query_2"></a>DNS Query</h5></div></div></div><p>A basic DNS Query form.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_default_room_config_2"></a>Default room config</h5></div></div></div><p>Allows you to set the default configuration for new MUC rooms. This will not be able to modify current in use and persistent rooms.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_delete_monitor_task_2"></a>Delete Monitor Task</h5></div></div></div><p>This removes a monitor task from the list of available monitor scripts. This action is not permanent as it will revert to initial settings on server restart.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_fix_user_s_roster_2"></a>Fix User&#8217;s Roster</h5></div></div></div><p>You can fix a users roster from this prompt. Fill out the bare JID of the user and the names you wish to add or remove from the roster. You can edit a users roster using this tool, and changes are permanent.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_fix_user_s_roster_on_tigase_cluster_2"></a>Fix User&#8217;s Roster on Tigase Cluster</h5></div></div></div><p>This does the same as the Fix User&#8217;s Roster, but can apply to users in clustered servers.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_user_roster_2"></a>Get User Roster</h5></div></div></div><p>As the title implies this gets a users' roster and displays it on screen. You can use a bare or full JID to get specific rosters.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_any_file_2"></a>Get any file</h5></div></div></div><p>Enables you to see the contents of any file in the tigase directory. By default you are in the root directory, if you wish to go into directory use the following format:
logs/tigase.log.0</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_configuration_file_2"></a>Get Configuration File</h5></div></div></div><p>If you don&#8217;t want to type in the location of a configuration file, you can use this prompt to bring up the contents of either tigase.conf or init.properties.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_get_init_properties_file_2"></a>Get init.properties File</h5></div></div></div><p>Will output the current init.properties file, this includes any modifications made during the current server session.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_load_errors_2"></a>Load Errors</h5></div></div></div><p>Will display any errors the server encounters in loading and running. Can be useful if you need to address any issues.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_new_command_script_monitor"></a>New command script - Monitor</h5></div></div></div><p>Allows you to write command scripts in Groovy and store them physically so they can be saved past server restart and run at any time. Scripts written here will only be able to work on the Monitor component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_new_command_script_muc"></a>New command script - MUC</h5></div></div></div><p>Allows you to write command scripts in Groovy and store them physically so they can be saved past server restart and run at any time. Scripts written here will only be able to work on the MUC component.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_oauth_credentials_2"></a>OAUth credentials</h5></div></div></div><p>Uses OAuth to set new credentials and enable or disable a registration requirement with a signed form.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_pre_bind_bosh_user_session_2"></a>Pre-Bind BOSH user session</h5></div></div></div><p>Allows admins to pre-bind a BOSH session with a full or bare JID (with the resource automatically populated on connection). You may also specify HOLD or WAIT parameters.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_reload_component_repository_2"></a>Reload component repository</h5></div></div></div><p>This will show if you have any external components and will reload them in case of any stuck threads.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_scripts_2"></a>Scripts</h5></div></div></div><p>This section provides a list of command scripts for all active components. Each component has the following options
- <span class="strong"><strong>Get list available commands</strong></span> will list script commands for the component divided by either Scripts or Groups.
- <span class="strong"><strong>New command script</strong></span> provides a method to author new command scripts for specific components written in EMCAScript or Groovy. You do have an option to save the script to disk which will make the script permanent within the server.
- <span class="strong"><strong>Remove command script</strong></span> allows you to remove the selected script from the repository. If Remove from disk is not checked, the script will be unavailable until server restart. If it is, it will be permanently removed from the server.</p><p>You will be unable to edit or run commands from this section.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_statistics_3"></a>Statistics</h5></div></div></div><p>These statistics might be more useful as script results yield small bits of data, but you may find them useful when looking for server loads or finding user issues.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_user_statistics_2"></a>Get User Statistics</h6></div></div></div><p>Provides a script output of user statistics including how many active sessions are in use, number of packets used, specific connections and their packet usage and location. All resources will return individual stats along with IP addresses.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_active_user_list_2"></a>Get Active User List</h6></div></div></div><p>Provides a list of active users under the selected domain within the server.  An active user is considered a user currently logged into the XMPP server.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_list_of_idle_users_2"></a>Get list of idle users</h6></div></div></div><p>This will list all idle users separated by vhost.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_list_of_online_users_2"></a>Get list of online users</h6></div></div></div><p>This will list users separated by the vhost they are connected to. The list will include the bare JID as well as any resources for that JID.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_number_of_active_users_2"></a>Get number of active users</h6></div></div></div><p>This displays the number of current active users.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_number_of_idle_users_2"></a>Get number of idle users</h6></div></div></div><p>This section returns the number of active users per specific vhost.</p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_top_active_users_2"></a>Get top active users</h6></div></div></div><p>This will list the top number of active users by packets sent and online time. This list will only be built with users currently online and from all vhosts.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_users_2"></a>Users</h5></div></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_add_new_user"></a>Add New User</h6></div></div></div><p>Here you can add new users to any domain handled by vHosts, users are added to database immediately and are able to login.  <span class="strong"><strong>NOTE: You cannot bestow admin status to these users in this section.</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_change_user_password_2"></a>Change user password</h6></div></div></div><p>Allows for admins to change the password of a specific user without needing to know the original password for the selected bare JID. Users currently logged in will not know password has been changed until they attempt to re-login.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_delete_user_2"></a>Delete user</h6></div></div></div><p>Provides a text window for admins to input the bare JID of the user they wish to remove from the server.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_user_info_2"></a>Get User Info</h6></div></div></div><p>This section allows admins to get information about a specific user including current connections as well as offline and online messages awaiting delivery.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_get_registered_user_list_2"></a>Get registered user list</h6></div></div></div><p>Provides a list of vhosts to search and a maximum number of users to list. Once run, the script will display a list of registered bare JIDs of users from the selected vhost.</p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="_modify_user_2"></a>Modify User</h6></div></div></div><p>Allows you to modify some user details including E-mail and whether it is an active user.</p></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="loadComponent.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="loadComponent.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="messageArchiving.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Message Archiving Component</td></tr></table></div></body></html>