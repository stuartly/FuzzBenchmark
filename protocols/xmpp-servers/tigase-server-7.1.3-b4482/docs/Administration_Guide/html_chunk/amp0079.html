<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Advanced Message Processing - AMP XEP-0079</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="loadComponent.html" title="Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component"><link rel="prev" href="messageArchiving.html" title="Message Archiving Component"><link rel="next" href="PubSubComp.html" title="PubSub Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Advanced Message Processing - AMP XEP-0079</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="messageArchiving.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;8.&nbsp;Configuring the Tigase Server to Load a Component</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="PubSubComp.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="amp0079"></a>Advanced Message Processing - AMP XEP-0079</h2></div></div></div><p>Tigase server <span class="strong"><strong>5.1.0</strong></span> or later offers support for <a class="link" href="http://xmpp.org/extensions/xep-0079.html" target="_top">Advanced Message Processing</a>, called AMP or XEP-0079.</p><p>It is enabled by default but there are several configuration options that you may tweak.</p><p>Configuration of AMP is not very complex, but as it is implemented as a component in the Tigase server it does needs a few settings to get it right.</p><p>Here is a first, brief overview of the AMP configuration and later  detailed explanation of each parameter.</p><pre class="programlisting">--sm-plugins=amp,-message,-msgoffline
--amp-repo-uri=jdbc:mysql://localhost/tigasedb?user=db_usr&amp;password=db_pwd
--amp-security-level=STRICT
sess-man/plugins-conf/amp/amp-jid=amp@your-domain.tld</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_first_of_all_plugins"></a>First of all: plugins:</h3></div></div></div><p>Even though the whole functionality is implemented inside the component you need a way to forward messages with AMP payload to that component. This is what the 'amp' plugin does. The 'amp' plugin intercepts all &lt;message/&gt; packets even without AMP payload, redirecting some of the to the AMP component and others processing in a standard way. Therefore you no longer need 'message' plugin or 'msgoffline' plugin. Those are all functions are offered by the 'amp' plugin now. Hence you have to switch 'message' and 'msgoffline' plugins off (the 'amp' plugin is loaded by default):</p><pre class="programlisting">--sm-plugins=+amp,-message,-msgoffline</pre><p>The 'amp' plugin needs to know where to forward all the AMP packets. By default plugin uses hostname of the given machine as this is true to the most installations. However, this is configured by the last line of the example configuration, which forwards all packets to the address '<a class="link" href="mailto:amp@your-domain.tld" target="_top">amp@your-domain.tld</a>':</p><pre class="programlisting">sess-man/plugins-conf/amp/amp-jid=amp@your-domain.tld</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_secondly_component"></a>Secondly: component:</h3></div></div></div><p>By default Tigase loads the component with the standard name 'amp'</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_optional_parameters"></a>Optional parameters:</h3></div></div></div><p>There is also one parameter shared between the component and the plugin. Connection to the database where offline messages are stored. The AMP component has a dedicated schema for storing offline messages designed for a high traffic and high load installations. It does not use UserRepository for storing messages.</p><p>By default the same physical database as for UserRepository is used but you can change it and store messages in a completely separate location to reduce performance degradation of rest of the system. You can set a database connection string using following property:</p><pre class="programlisting">--amp-repo-uri=jdbc:mysql://localhost/tigasedb?user=db_usr&amp;password=db_pwd</pre><p>The <a class="link" href="http://xmpp.org/extensions/xep-0079.html" target="_top">XEP-0079</a> specification has a <a class="link" href="http://xmpp.org/extensions/xep-0079.html#security" target="_top">Section 9. - Security Considerations</a>. As it describes, in some cases the AMP protocol can be used to reveal user&#8217;s presence information by other users who are not authorised for presence updates. There are a few possible ways to prevent this.</p><p>Tigase&#8217;s implementation offers 3 modes to handle AMP requests to prevent revealing user&#8217;s status to non-authorized users:</p><pre class="programlisting">--amp-security-level=STRICT</pre><p>In this mode the server performs strict checking. The AMP specification is fully handled. This however involves roster loading for each offline user, hence it may impact the service performance. It may not be feasible or possible to run in this mode for services under a high load with lots of AMP messages.</p><p>In the XEP this mode is described in the following way:</p><p><span class="emphasis"><em>Accept the relevant condition only if the sender is authorized to receive the receiver&#8217;s presence, as a result of which the server MUST reply with a &lt;not-acceptable/&gt; error condition if the sender is not so authorized; this is the RECOMMENDED behavior. This is also the default in Tigase.</em></span></p><pre class="programlisting">--amp-security-level=PERFORMANCE</pre><p>Dummy checking is performed efficiently by just returning an error response every time there is a chance that the default action may reveal user status without looking into the user&#8217;s roster. This does not affect performance but it does impact the AMP compliance.</p><p>In the XEP this mode is described in the following way:</p><p><span class="emphasis"><em>Accept the relevant condition only if the action is "drop", as a result of which the server MUST reply with a &lt;not-acceptable/&gt; error condition if the action is "alert", "error", or "notify"; this is slightly less restrictive but still unnecessarily restricts the functionality of the system, so is NOT RECOMMENDED.</em></span></p><p>It does not do any checking. It acts like all users are authorized to receive notifications, even if it may reveal user status to unauthorized users. It does not impact the server performance and it offers full AMP compliance.</p><pre class="programlisting">--amp-security-level=NONE</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="messageArchiving.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="loadComponent.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="PubSubComp.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Message Archiving Component&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;PubSub Component</td></tr></table></div></body></html>