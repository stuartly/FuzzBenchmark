<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tigase Server Network Instructions</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="QuickStart.html" title="Chapter&nbsp;3.&nbsp;Quick Start Guide"><link rel="prev" href="windowsInstallation.html" title="Windows Installation"><link rel="next" href="tigaseScriptStart.html" title="Tigase Script Selection"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Tigase Server Network Instructions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="windowsInstallation.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Quick Start Guide</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="tigaseScriptStart.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setupTigaseServer"></a>Tigase Server Network Instructions</h2></div></div></div><p>One you have installed Tigase XMPP Server on a machine, you&#8217;re going to want to use it.  If you are just using for local communications on a network behind a router, you&#8217;re all set.  Enjoy and use!</p><p>However, if you want to have people from other computers outside your network connect to your server, you&#8217;re going to have to go through a few more steps to show your server out to the public.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This guide is merely a recommendation of how to get a local server to be open to incoming communications.  Any time you open ports, or take other security measures you risk compromising your network security.  These are only recommendations, and may not be appropriate for all installations.  Please consult your IT Security expert for securing your own installation.</p></div><p>XMPP, being a decentralized communication method, relies on proper DNS records to figure out where and how an XMPP server is setup.  Operating an XMPP Server will require you to properly setup DNS routing so not only can clients connect to you, but if you decide to run a federated server and enable server to server communication, you will need to do the same.  If you already have a DNS server already, you should have little issue adding these records.
If you do not have a DNS setup pointing to your server, you may use a free dynamic name service such as dynu.com.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_a_records"></a>A Records</h3></div></div></div><p>You will not be able to use an IP Address or a CNAME record to setup an XMPP Server.  While it&#8217;s not required, an A record can provide some other benefits such serving as a backup in case the SRV record is not configured right.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_srv_records"></a>SRV Records</h3></div></div></div><p>You will need to set SRV records both for client-to-server (c2s) communication and, if you plan to use it, server to server (s2s) communication.  We recommend both records are entered for every server as some resources or clients will check for both records.
For this example we will use tigase.org is our domain, and xmpp as the xmpp server subdomain.</p><p>SRV records have the following form:</p><p>_service._protocol.name. TTL class SRV Priority weight port target.</p><p>The key is as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>service</strong></span>: is the symbolic name of the desired service, in this case it would be <span class="emphasis"><em>xmpp-client</em></span> or <span class="emphasis"><em>xmpp-server</em></span>.</li><li class="listitem"><span class="strong"><strong>protocol</strong></span>: is the transport protocol, either TCP or UDP, XMPP traffic will take place over <span class="emphasis"><em>TCP</em></span>.</li><li class="listitem"><span class="strong"><strong>name</strong></span>: the domain name where the server resides, in this case <span class="emphasis"><em>tigase.org</em></span>.</li><li class="listitem"><span class="strong"><strong>TTL</strong></span>: a numeric value for DNS time to live in milliseconds, by default use <span class="emphasis"><em>86400</em></span>.</li><li class="listitem"><span class="strong"><strong>class</strong></span>: DNS class field, this is always <span class="emphasis"><em>IN</em></span>.</li><li class="listitem"><span class="strong"><strong>priority</strong></span>: the priority of the target host with lower numbers being higher priority.  Since we are not setting up multiple SRV records, we can use <span class="emphasis"><em>0</em></span>.</li><li class="listitem"><span class="strong"><strong>weight</strong></span>: the relative weight for records with the same priority. We can use <span class="emphasis"><em>5</em></span>.</li><li class="listitem"><span class="strong"><strong>port</strong></span>: the specific TCP or UDP port where the service can be found. In this case it will be <span class="emphasis"><em>5222</em></span> or <span class="emphasis"><em>5269</em></span>.</li><li class="listitem"><span class="strong"><strong>target</strong></span>: the hostname of the machine providing the service, here we will use <span class="emphasis"><em>xmpp.tigase.org</em></span>.</li></ul></div><p>For our example server, the SRV records will then look like this:</p><p><span class="strong"><strong>_xmpp-client._TCP.tigase.org 86400 IN SRV 0 5 5222 xmpp.tigase.org</strong></span></p><p><span class="strong"><strong>_xmpp-server._TCP.tigase.org 86400 IN SRV 0 5 5269 xmpp.tigase.org</strong></span></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_tigase_and_vhosts"></a>Tigase and Vhosts</h4></div></div></div><p>If you are running multiple vhosts or subdomains that you wish to separate, you will need another record.  In this case an A record will be all you need if you are using default ports.  If you are using custom ports, you will need to have a new SRV record for each subdomain.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_checking_setup"></a>Checking setup</h3></div></div></div><p>If you have a cell phone on a separate network with an XMPP client, you can now try to login to test the server. If that is not handy, you can use an online tool to check proper DNS records such as kingant&#8217;s: <a class="link" href="https://kingant.net/check_xmpp_dns/" target="_top">https://kingant.net/check_xmpp_dns/</a> and it will tell you if anything is missing.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_ports_description"></a>Ports description</h3></div></div></div><p>Once your server is setup, you may need to open at least two ports. By default XMPP communication happens on ports 5222/5269, to which point SRV records. Other ports used by the server are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">3478</code> (TURN or STUN, plain socket, TCP and UDP)</li><li class="listitem"><code class="literal">5349</code> (TURN or STUN, over TLS, TCP and UDP)</li><li class="listitem"><code class="literal">5222</code> (default XMPP socket port)</li><li class="listitem"><code class="literal">5223</code> (legacy XMPP socket port)</li><li class="listitem"><code class="literal">5269</code> (default s2s port, i.e.: federation support)</li><li class="listitem"><code class="literal">5277</code> (component protocol port, e.g.: for external components)</li><li class="listitem"><code class="literal">5280</code> (default BOSH port)</li><li class="listitem"><code class="literal">5290</code> (default WebSocket port)</li><li class="listitem"><code class="literal">8080</code> (HTTP API component port)</li><li class="listitem"><code class="literal">9050</code> (JMX Monitoring)</li></ul></div><p>If for any reason you can&#8217;t use default ports and have to change them it&#8217;s possible to point SRV records those ports. Please keep in mind, that you have to open those ports for incoming connections in your firewall. In case you are using <code class="literal">iptables</code> you can use following command to include those ports in your rules:</p><pre class="programlisting">iptables -A INPUT -p tcp -m tcp --dport 5222 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 5223 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 5269 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 5277 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 5280 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 5290 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 8080 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 9050 -j ACCEPT</pre><p>Both ports should be setup to use TCP only. If for any reason you want to make service available for different ports you can:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">change ports in Tigase configuration and update DNS SRV records;</li><li class="listitem"><p class="simpara">forward those ports to default Tigase ports (this is especially useful under *nix operating system if you want to utilize ports lower than <code class="literal">1024</code> while running, as recommended, Tigase service from user account - there is a limitation and user accounts can bind to ports lower than <code class="literal">1024</code>), for example using <code class="literal">iptables</code> rules (in following example we are making available Tigase SSL websocket port available under port <code class="literal">443</code>, which is usually opened in corporate firewalls):</p><pre class="programlisting">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 5291</pre></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="windowsInstallation.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="QuickStart.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="tigaseScriptStart.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Windows Installation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Tigase Script Selection</td></tr></table></div></body></html>